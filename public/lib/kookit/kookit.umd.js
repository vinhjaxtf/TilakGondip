!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Kookit={})}(this,function(t){"use strict";function n(t,u,s,a){return new(s=s||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof s?e:new s(function(t){t(e)})).then(r,i)}o((a=a.apply(t,u||[])).next())})}function o(n,r){var i,o,u,s={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(u=2&e[0]?o.return:e[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,e[1])).done)return u;switch(o=0,(e=u?[2&e[0],u.value]:e)[0]){case 0:case 1:u=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(u=0<(u=s.trys).length&&u[u.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!u||e[1]>u[0]&&e[1]<u[3])){s.label=e[1];break}if(6===e[0]&&s.label<u[1]){s.label=u[1],u=e;break}if(u&&s.label<u[2]){s.label=u[2],s.ops.push(e);break}u[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=u=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var e="1.13.1",r="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,u=Object.prototype,h="undefined"!=typeof Symbol?Symbol.prototype:null,s=i.push,a=i.slice,l=u.toString,c=u.hasOwnProperty,f="undefined"!=typeof ArrayBuffer,p="undefined"!=typeof DataView,d=Array.isArray,g=Object.keys,m=Object.create,v=f&&ArrayBuffer.isView,y=isNaN,b=isFinite,x=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],L=Math.pow(2,53)-1;function _(i,o){return o=null==o?i.length-1:+o,function(){for(var t=Math.max(arguments.length-o,0),e=Array(t),n=0;n<t;n++)e[n]=arguments[n+o];switch(o){case 0:return i.call(this,e);case 1:return i.call(this,arguments[0],e);case 2:return i.call(this,arguments[0],arguments[1],e)}for(var r=Array(o+1),n=0;n<o;n++)r[n]=arguments[n];return r[o]=e,i.apply(this,r)}}function T(t){var e=typeof t;return"function"==e||"object"==e&&!!t}function D(t){return void 0===t}function k(t){return!0===t||!1===t||"[object Boolean]"===l.call(t)}function A(t){var e="[object "+t+"]";return function(t){return l.call(t)===e}}var O=A("String"),C=A("Number"),S=A("Date"),M=A("RegExp"),U=A("Error"),I=A("Symbol"),j=A("ArrayBuffer"),E=A("Function"),H=r.document&&r.document.childNodes,B=E="function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof H?function(t){return"function"==typeof t||!1}:E,N=A("Object"),W=p&&N(new DataView(new ArrayBuffer(8))),F="undefined"!=typeof Map&&N(new Map),z=A("DataView");var P=W?function(t){return null!=t&&B(t.getInt8)&&j(t.buffer)}:z,R=d||A("Array");function K(t,e){return null!=t&&c.call(t,e)}var $=A("Arguments");!function(){$(arguments)||($=function(t){return K(t,"callee")})}();var q=$;function V(t){return C(t)&&y(t)}function X(t){return function(){return t}}function J(e){return function(t){t=e(t);return"number"==typeof t&&0<=t&&t<=L}}function Y(e){return function(t){return null==t?void 0:t[e]}}var Z=Y("byteLength"),G=J(Z),Q=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var tt=f?function(t){return v?v(t)&&!P(t):G(t)&&Q.test(l.call(t))}:X(!1),et=Y("length");function nt(t,e){e=function(e){for(var n={},t=e.length,r=0;r<t;++r)n[e[r]]=!0;return{contains:function(t){return n[t]},push:function(t){return n[t]=!0,e.push(t)}}}(e);var n=w.length,r=t.constructor,i=B(r)&&r.prototype||u,o="constructor";for(K(t,o)&&!e.contains(o)&&e.push(o);n--;)(o=w[n])in t&&t[o]!==i[o]&&!e.contains(o)&&e.push(o)}function rt(t){if(!T(t))return[];if(g)return g(t);var e,n=[];for(e in t)K(t,e)&&n.push(e);return x&&nt(t,n),n}function it(t,e){var n=rt(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var u=n[o];if(e[u]!==i[u]||!(u in i))return!1}return!0}function ot(t){return t instanceof ot?t:this instanceof ot?void(this._wrapped=t):new ot(t)}function ut(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Z(t))}ot.VERSION=e,ot.prototype.valueOf=ot.prototype.toJSON=ot.prototype.value=function(){return this._wrapped},ot.prototype.toString=function(){return String(this._wrapped)};var st="[object DataView]";function at(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"==i||"object"==i||"object"==typeof e)&&function t(e,n,r,i){e instanceof ot&&(e=e._wrapped);n instanceof ot&&(n=n._wrapped);var o=l.call(e);if(o!==l.call(n))return!1;if(W&&"[object Object]"==o&&P(e)){if(!P(n))return!1;o=st}switch(o){case"[object RegExp]":case"[object String]":return""+e==""+n;case"[object Number]":return+e!=+e?+n!=+n:0==+e?1/+e==1/n:+e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object Symbol]":return h.valueOf.call(e)===h.valueOf.call(n);case"[object ArrayBuffer]":case st:return t(ut(e),ut(n),r,i)}var u="[object Array]"===o;if(!u&&tt(e)){var s=Z(e);if(s!==Z(n))return!1;if(e.buffer===n.buffer&&e.byteOffset===n.byteOffset)return!0;u=!0}if(!u){if("object"!=typeof e||"object"!=typeof n)return!1;o=e.constructor,s=n.constructor;if(o!==s&&!(B(o)&&o instanceof o&&B(s)&&s instanceof s)&&"constructor"in e&&"constructor"in n)return!1}r=r||[];i=i||[];var a=r.length;for(;a--;)if(r[a]===e)return i[a]===n;r.push(e);i.push(n);if(u){if((a=e.length)!==n.length)return!1;for(;a--;)if(!at(e[a],n[a],r,i))return!1}else{var c,f=rt(e);if(a=f.length,rt(n).length!==a)return!1;for(;a--;)if(c=f[a],!K(n,c)||!at(e[c],n[c],r,i))return!1}r.pop();i.pop();return!0}(t,e,n,r)}function ct(t){if(!T(t))return[];var e,n=[];for(e in t)n.push(e);return x&&nt(t,n),n}function ft(r){var i=et(r);return function(t){if(null==t)return!1;var e=ct(t);if(et(e))return!1;for(var n=0;n<i;n++)if(!B(t[r[n]]))return!1;return r!==gt||!B(t[ht])}}var ht="forEach",lt=["clear","delete"],pt=["get","has","set"],dt=lt.concat(ht,pt),gt=lt.concat(pt),mt=["add"].concat(lt,ht,"has"),vt=F?ft(dt):A("Map"),yt=F?ft(gt):A("WeakMap"),bt=F?ft(mt):A("Set"),xt=A("WeakSet");function wt(t){for(var e=rt(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function Lt(t){for(var e={},n=rt(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function _t(t){var e,n=[];for(e in t)B(t[e])&&n.push(e);return n.sort()}function Tt(a,c){return function(t){var e=arguments.length;if(c&&(t=Object(t)),e<2||null==t)return t;for(var n=1;n<e;n++)for(var r=arguments[n],i=a(r),o=i.length,u=0;u<o;u++){var s=i[u];c&&void 0!==t[s]||(t[s]=r[s])}return t}}var Dt=Tt(ct),kt=Tt(rt),At=Tt(ct,!0);function Ot(t){if(!T(t))return{};if(m)return m(t);var e=function(){};e.prototype=t;t=new e;return e.prototype=null,t}function Ct(t){return T(t)?R(t)?t.slice():Dt({},t):t}function St(t){return R(t)?t:[t]}function Mt(t){return ot.toPath(t)}function Ut(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0}function It(t,e,n){e=Ut(t,Mt(e));return D(e)?n:e}function jt(t){return t}function Et(e){return e=kt({},e),function(t){return it(t,e)}}function Ht(e){return e=Mt(e),function(t){return Ut(t,e)}}function Bt(i,o,t){if(void 0===o)return i;switch(null==t?3:t){case 1:return function(t){return i.call(o,t)};case 3:return function(t,e,n){return i.call(o,t,e,n)};case 4:return function(t,e,n,r){return i.call(o,t,e,n,r)}}return function(){return i.apply(o,arguments)}}function Nt(t,e,n){return null==t?jt:B(t)?Bt(t,e,n):(T(t)&&!R(t)?Et:Ht)(t)}function Wt(t,e){return Nt(t,e,1/0)}function Ft(t,e,n){return ot.iteratee!==Wt?ot.iteratee(t,e):Nt(t,e,n)}function zt(){}function Pt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}ot.toPath=St,ot.iteratee=Wt;var Rt=Date.now||function(){return(new Date).getTime()};function Kt(e){function n(t){return e[t]}var t="(?:"+rt(e).join("|")+")",r=RegExp(t),i=RegExp(t,"g");return function(t){return r.test(t=null==t?"":""+t)?t.replace(i,n):t}}var $t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},qt=Kt($t),Vt=Kt(Lt($t)),Xt=ot.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Jt=/(.)^/,Yt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Zt=/\\|'|\r|\n|\u2028|\u2029/g;function Gt(t){return"\\"+Yt[t]}var Qt=/^\s*(\w|\$)+\s*$/;var te=0;function ee(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);n=Ot(t.prototype),i=t.apply(n,i);return T(i)?i:n}var ne=_(function(i,o){function u(){for(var t=0,e=o.length,n=Array(e),r=0;r<e;r++)n[r]=o[r]===s?arguments[t++]:o[r];for(;t<arguments.length;)n.push(arguments[t++]);return ee(i,u,this,this,n)}var s=ne.placeholder;return u});ne.placeholder=ot;var re=_(function(e,n,r){if(!B(e))throw new TypeError("Bind must be called on a function");var i=_(function(t){return ee(e,i,n,this,r.concat(t))});return i}),ie=J(et);function oe(t,e,n,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var i=r.length,o=0,u=et(t);o<u;o++){var s=t[o];if(ie(s)&&(R(s)||q(s)))if(1<e)oe(s,e-1,n,r),i=r.length;else for(var a=0,c=s.length;a<c;)r[i++]=s[a++];else n||(r[i++]=s)}return r}var ue=_(function(t,e){var n=(e=oe(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=re(t[r],t)}return t});var se=_(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),ae=ne(se,ot,1);function ce(t){return function(){return!t.apply(this,arguments)}}function fe(t,e){var n;return function(){return 0<--t&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}r=ne(fe,2);function he(t,e,n){e=Ft(e,n);for(var r,i=rt(t),o=0,u=i.length;o<u;o++)if(e(t[r=i[o]],r,t))return r}function le(o){return function(t,e,n){e=Ft(e,n);for(var r=et(t),i=0<o?0:r-1;0<=i&&i<r;i+=o)if(e(t[i],i,t))return i;return-1}}var pe=le(1),H=le(-1);function de(t,e,n,r){for(var i=(n=Ft(n,r,1))(e),o=0,u=et(t);o<u;){var s=Math.floor((o+u)/2);n(t[s])<i?o=s+1:u=s}return o}function ge(o,u,s){return function(t,e,n){var r=0,i=et(t);if("number"==typeof n)0<o?r=0<=n?n:Math.max(n+i,r):i=0<=n?Math.min(n+1,i):n+i+1;else if(s&&n&&i)return t[n=s(t,e)]===e?n:-1;if(e!=e)return 0<=(n=u(a.call(t,r,i),V))?n+r:-1;for(n=0<o?r:i-1;0<=n&&n<i;n+=o)if(t[n]===e)return n;return-1}}var me=ge(1,pe,de),E=ge(-1,H);function ve(t,e,n){n=(ie(t)?pe:he)(t,e,n);if(void 0!==n&&-1!==n)return t[n]}function ye(t,e,n){if(e=Bt(e,n),ie(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else for(var r=rt(t),i=0,o=r.length;i<o;i++)e(t[r[i]],r[i],t);return t}function be(t,e,n){e=Ft(e,n);for(var r=!ie(t)&&rt(t),i=(r||t).length,o=Array(i),u=0;u<i;u++){var s=r?r[u]:u;o[u]=e(t[s],s,t)}return o}function xe(a){return function(t,e,n,r){var i=3<=arguments.length;return function(t,e,n,r){var i=!ie(t)&&rt(t),o=(i||t).length,u=0<a?0:o-1;for(r||(n=t[i?i[u]:u],u+=a);0<=u&&u<o;u+=a){var s=i?i[u]:u;n=e(n,t[s],s,t)}return n}(t,Bt(e,r,4),n,i)}}p=xe(1),N=xe(-1);function we(t,r,e){var i=[];return r=Ft(r,e),ye(t,function(t,e,n){r(t,e,n)&&i.push(t)}),i}function Le(t,e,n){e=Ft(e,n);for(var r=!ie(t)&&rt(t),i=(r||t).length,o=0;o<i;o++){var u=r?r[o]:o;if(!e(t[u],u,t))return!1}return!0}function _e(t,e,n){e=Ft(e,n);for(var r=!ie(t)&&rt(t),i=(r||t).length,o=0;o<i;o++){var u=r?r[o]:o;if(e(t[u],u,t))return!0}return!1}function Te(t,e,n,r){return ie(t)||(t=wt(t)),0<=me(t,e,n="number"!=typeof n||r?0:n)}z=_(function(t,n,r){var i,o;return B(n)?o=n:(n=Mt(n),i=n.slice(0,-1),n=n[n.length-1]),be(t,function(t){var e=o;if(!e){if(null==(t=i&&i.length?Ut(t,i):t))return;e=t[n]}return null==e?e:e.apply(t,r)})});function De(t,e){return be(t,Ht(e))}function ke(t,r,e){var n,i,o=-1/0,u=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var s=0,a=(t=ie(t)?t:wt(t)).length;s<a;s++)null!=(n=t[s])&&o<n&&(o=n);else r=Ft(r,e),ye(t,function(t,e,n){i=r(t,e,n),(u<i||i===-1/0&&o===-1/0)&&(o=t,u=i)});return o}function Ae(t,e,n){if(null==e||n)return(t=!ie(t)?wt(t):t)[Pt(t.length-1)];var r=(ie(t)?Ct:wt)(t),t=et(r);e=Math.max(Math.min(e,t),0);for(var i=t-1,o=0;o<e;o++){var u=Pt(o,i),s=r[o];r[o]=r[u],r[u]=s}return r.slice(0,e)}function Oe(o,e){return function(n,r,t){var i=e?[[],[]]:{};return r=Ft(r,t),ye(n,function(t,e){e=r(t,e,n);o(i,t,e)}),i}}var d=Oe(function(t,e,n){K(t,n)?t[n].push(e):t[n]=[e]}),f=Oe(function(t,e,n){t[n]=e}),pt=Oe(function(t,e,n){K(t,n)?t[n]++:t[n]=1}),lt=Oe(function(t,e,n){t[n?0:1].push(e)},!0),Ce=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Se(t,e,n){return e in n}var Me=_(function(t,e){var n={},r=e[0];if(null==t)return n;B(r)?(1<e.length&&(r=Bt(r,e[1])),e=ct(t)):(r=Se,e=oe(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var u=e[i],s=t[u];r(s,u,t)&&(n[u]=s)}return n}),dt=_(function(t,n){var e,r=n[0];return B(r)?(r=ce(r),1<n.length&&(e=n[1])):(n=be(oe(n,!1,!1),String),r=function(t,e){return!Te(n,e)}),Me(t,r,e)});function Ue(t,e,n){return a.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function Ie(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Ue(t,t.length-e)}function je(t,e,n){return a.call(t,null==e||n?1:e)}var Ee=_(function(t,e){return e=oe(e,!0,!0),we(t,function(t){return!Te(e,t)})}),F=_(function(t,e){return Ee(t,e)});function He(t,e,n,r){k(e)||(r=n,n=e,e=!1),null!=n&&(n=Ft(n,r));for(var i=[],o=[],u=0,s=et(t);u<s;u++){var a=t[u],c=n?n(a,u,t):a;e&&!n?(u&&o===c||i.push(a),o=c):n?Te(o,c)||(o.push(c),i.push(a)):Te(i,a)||i.push(a)}return i}mt=_(function(t){return He(oe(t,!0,!0))});function Be(t){for(var e=t&&ke(t,et).length||0,n=Array(e),r=0;r<e;r++)n[r]=De(t,r);return n}$t=_(Be);function Ne(t,e){return t._chain?ot(e).chain():e}function We(n){return ye(_t(n),function(t){var e=ot[t]=n[t];ot.prototype[t]=function(){var t=[this._wrapped];return s.apply(t,arguments),Ne(this,e.apply(ot,t))}}),ot}ye(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=i[e];ot.prototype[e]=function(){var t=this._wrapped;return null!=t&&(n.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0]),Ne(this,t)}}),ye(["concat","join","slice"],function(t){var e=i[t];ot.prototype[t]=function(){var t=this._wrapped;return Ne(this,t=null!=t?e.apply(t,arguments):t)}});var Fe=We(Object.freeze({__proto__:null,VERSION:e,restArguments:_,isObject:T,isNull:function(t){return null===t},isUndefined:D,isBoolean:k,isElement:function(t){return!(!t||1!==t.nodeType)},isString:O,isNumber:C,isDate:S,isRegExp:M,isError:U,isSymbol:I,isArrayBuffer:j,isDataView:P,isArray:R,isFunction:B,isArguments:q,isFinite:function(t){return!I(t)&&b(t)&&!isNaN(parseFloat(t))},isNaN:V,isTypedArray:tt,isEmpty:function(t){if(null==t)return!0;var e=et(t);return"number"==typeof e&&(R(t)||O(t)||q(t))?0===e:0===et(rt(t))},isMatch:it,isEqual:function(t,e){return at(t,e)},isMap:vt,isWeakMap:yt,isSet:bt,isWeakSet:xt,keys:rt,allKeys:ct,values:wt,pairs:function(t){for(var e=rt(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},invert:Lt,functions:_t,methods:_t,extend:Dt,extendOwn:kt,assign:kt,defaults:At,create:function(t,e){return t=Ot(t),e&&kt(t,e),t},clone:Ct,tap:function(t,e){return e(t),t},get:It,has:function(t,e){for(var n=(e=Mt(e)).length,r=0;r<n;r++){var i=e[r];if(!K(t,i))return!1;t=t[i]}return!!n},mapObject:function(t,e,n){e=Ft(e,n);for(var r=rt(t),i=r.length,o={},u=0;u<i;u++){var s=r[u];o[s]=e(t[s],s,t)}return o},identity:jt,constant:X,noop:zt,toPath:St,property:Ht,propertyOf:function(e){return null==e?zt:function(t){return It(e,t)}},matcher:Et,matches:Et,times:function(t,e,n){var r=Array(Math.max(0,t));e=Bt(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},random:Pt,now:Rt,escape:qt,unescape:Vt,templateSettings:Xt,template:function(o,t,e){t=At({},t=!t&&e?e:t,ot.templateSettings);var n,e=RegExp([(t.escape||Jt).source,(t.interpolate||Jt).source,(t.evaluate||Jt).source].join("|")+"|$","g"),u=0,s="__p+='";if(o.replace(e,function(t,e,n,r,i){return s+=o.slice(u,i).replace(Zt,Gt),u=i+t.length,e?s+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":n?s+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(s+="';\n"+r+"\n__p+='"),t}),s+="';\n",e=t.variable){if(!Qt.test(e))throw new Error("variable is not a bare identifier: "+e)}else s="with(obj||{}){\n"+s+"}\n",e="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{n=new Function(e,"_",s)}catch(t){throw t.source=s,t}return(t=function(t){return n.call(this,t,ot)}).source="function("+e+"){\n"+s+"}",t},result:function(t,e,n){var r=(e=Mt(e)).length;if(!r)return B(n)?n.call(t):n;for(var i=0;i<r;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=n,i=r),t=B(o)?o.call(t):o}return t},uniqueId:function(t){var e=++te+"";return t?t+e:e},chain:function(t){return(t=ot(t))._chain=!0,t},iteratee:Wt,partial:ne,bind:re,bindAll:ue,memoize:function(n,r){function i(t){var e=i.cache,t=""+(r?r.apply(this,arguments):t);return K(e,t)||(e[t]=n.apply(this,arguments)),e[t]}return i.cache={},i},delay:se,defer:ae,throttle:function(n,r,i){var o,u,s,a,c=0;function f(){c=!1===i.leading?0:Rt(),o=null,a=n.apply(u,s),o||(u=s=null)}function t(){var t=Rt();c||!1!==i.leading||(c=t);var e=r-(t-c);return u=this,s=arguments,e<=0||r<e?(o&&(clearTimeout(o),o=null),c=t,a=n.apply(u,s),o||(u=s=null)):o||!1===i.trailing||(o=setTimeout(f,e)),a}return i=i||{},t.cancel=function(){clearTimeout(o),c=0,o=u=s=null},t},debounce:function(e,n,r){function i(){var t=Rt()-u;t<n?o=setTimeout(i,n-t):(o=null,r||(a=e.apply(c,s)),o||(s=c=null))}var o,u,s,a,c,t=_(function(t){return c=this,s=t,u=Rt(),o||(o=setTimeout(i,n),r&&(a=e.apply(c,s))),a});return t.cancel=function(){clearTimeout(o),o=s=c=null},t},wrap:function(t,e){return ne(e,t)},negate:ce,compose:function(){var n=arguments,r=n.length-1;return function(){for(var t=r,e=n[r].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:fe,once:r,findKey:he,findIndex:pe,findLastIndex:H,sortedIndex:de,indexOf:me,lastIndexOf:E,find:ve,detect:ve,findWhere:function(t,e){return ve(t,Et(e))},each:ye,forEach:ye,map:be,collect:be,reduce:p,foldl:p,inject:p,reduceRight:N,foldr:N,filter:we,select:we,reject:function(t,e,n){return we(t,ce(Ft(e)),n)},every:Le,all:Le,some:_e,any:_e,contains:Te,includes:Te,include:Te,invoke:z,pluck:De,where:function(t,e){return we(t,Et(e))},max:ke,min:function(t,r,e){var n,i,o=1/0,u=1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var s=0,a=(t=ie(t)?t:wt(t)).length;s<a;s++)null!=(n=t[s])&&n<o&&(o=n);else r=Ft(r,e),ye(t,function(t,e,n){((i=r(t,e,n))<u||i===1/0&&o===1/0)&&(o=t,u=i)});return o},shuffle:function(t){return Ae(t,1/0)},sample:Ae,sortBy:function(t,r,e){var i=0;return r=Ft(r,e),De(be(t,function(t,e,n){return{value:t,index:i++,criteria:r(t,e,n)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index}),"value")},groupBy:d,indexBy:f,countBy:pt,partition:lt,toArray:function(t){return t?R(t)?a.call(t):O(t)?t.match(Ce):ie(t)?be(t,jt):wt(t):[]},size:function(t){return null==t?0:(ie(t)?t:rt(t)).length},pick:Me,omit:dt,first:Ie,head:Ie,take:Ie,initial:Ue,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:je(t,Math.max(0,t.length-e))},rest:je,tail:je,drop:je,compact:function(t){return we(t,Boolean)},flatten:function(t,e){return oe(t,e,!1)},without:F,uniq:He,unique:He,union:mt,intersection:function(t){for(var e=[],n=arguments.length,r=0,i=et(t);r<i;r++){var o=t[r];if(!Te(e,o)){for(var u=1;u<n&&Te(arguments[u],o);u++);u===n&&e.push(o)}}return e},difference:Ee,unzip:Be,transpose:Be,zip:$t,object:function(t,e){for(var n={},r=0,i=et(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n=n||(e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(a.call(t,r,r+=e));return n},mixin:We,default:ot}));Fe._=Fe;function ze(t,e){return void 0===e&&(e=!1),t&&-1===t.indexOf("[")&&-1===t.indexOf("(")&&-1===t.indexOf("。")&&(t.startsWith("CHAPTER")||t.startsWith("Chapter")||t.startsWith("序章")||t.startsWith("前言")||t.startsWith("声明")||t.startsWith("聲明")||t.startsWith("写在前面的话")||t.startsWith("后记")||t.startsWith("楔子")||t.startsWith("后序")||t.startsWith("寫在前面的話")||t.startsWith("後記")||t.startsWith("後序")||t.startsWith("第")&&Ke(t)||t.startsWith("卷")&&$e(t)||!e&&-1<t.indexOf("第")&&(" "===t[t.indexOf("第")-1]||"　"===t[t.indexOf("第")-1]||"、"===t[t.indexOf("第")-1]||"："===t[t.indexOf("第")-1]||":"===t[t.indexOf("第")-1])&&Ke(t.substr(t.indexOf("第")))||!e&&t.indexOf(" ")&&qe(t)||!e&&t.indexOf("　")&&qe(t)||!e&&t.indexOf("、")&&Xe(t)||!e&&t.indexOf("：")&&Ve(t)||!e&&t.indexOf(":")&&Ve(t))}function Pe(){[].filter.constructor('[]["filter"]["constructor"](atob("dmFyIF8weDdiMWIgPSBbCiAgICAgICAgIlx4NEJceDZGXHg2Rlx4NjRceDZGXHgyMFx4NTJceDY1XHg2MVx4NjRceDY1XHg3MiIsCiAgICAgICAgIlx4NjlceDZFXHg2NFx4NjVceDc4XHg0Rlx4NjYiLAogICAgICAgICJceDc0XHg2OVx4NzRceDZDXHg2NSIsCiAgICAgIF07CiAgICAgIGlmIChkb2N1bWVudFtfMHg3YjFiWzJdXVtfMHg3YjFiWzFdXShfMHg3YjFiWzBdKSA9PT0gLTEpIHsKICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9"))()')()}var Re=["章","节","回","節","卷","部","輯","辑","話","集","话","篇"],Ke=function(t){for(var e=!1,n=0;n<Re.length&&((!(-1<t.indexOf(Re[n]))||" "!==t[t.indexOf(Re[n])+1]&&"　"!==t[t.indexOf(Re[n])+1]&&"、"!==t[t.indexOf(Re[n])+1]&&"："!==t[t.indexOf(Re[n])+1]&&":"!==t[t.indexOf(Re[n])+1])&&t[t.indexOf(Re[n])+1]||!(e=!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf(Re[n])).trim())&&!/^\d+$/.test(t.substring(1,t.indexOf(Re[n])).trim()))||e));n++);return e},$e=function(t){return!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf(" ")))&&!/^\d+$/.test(t.substring(1,t.indexOf(" "))))||(!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf("　")))&&!/^\d+$/.test(t.substring(1,t.indexOf("　"))))||!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1))&&!/^\d+$/.test(t.substring(1))))},qe=function(t){return!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf(" ")))||(!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("　")))||(!!/^\d+$/.test(t.substring(0,t.indexOf(" ")))||!!/^\d+$/.test(t.substring(0,t.indexOf("　")))))},Ve=function(t){return!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf(":")))||(!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("：")))||(!!/^\d+$/.test(t.substring(0,t.indexOf(":")))||!!/^\d+$/.test(t.substring(0,t.indexOf("：")))))},Xe=function(t){return!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("、")))||!!/^\d+$/.test(t.substring(0,t.indexOf("、")))},Je=(Ye.getKookitConfig=function(t){return(JSON.parse(localStorage.getItem("kookitConfig"))||{})[t]},Ye.setKookitConfig=function(t,e){var n=JSON.parse(localStorage.getItem("kookitConfig"))||{};n[t]=e,localStorage.setItem("kookitConfig",JSON.stringify(n))},Ye);function Ye(){}function Ze(t){var e=document.createElement("iframe");e.style.width=t.offsetWidth+"px",e.style.border="0",e.style.margin="0",e.style.padding="0",e.style.fontSize="100%",e.style.font="inherit",e.style.verticalAlign="baseline",t.appendChild(e)}function Ge(e,n,r,i){var t=document.getElementsByTagName("iframe")[0];!t||(t=t.contentDocument)&&(-1<navigator.userAgent.indexOf("Firefox")?t.addEventListener("DOMMouseScroll",function(t){"continuous"!==i&&nn(e,t.detail),tn(e,i),Qe(e,n,r,i)},!1):t.addEventListener("mousewheel",function(t){"continuous"!==i&&nn(e,t.wheelDelta),tn(e,i),Qe(e,n,r,i)},!1))}function Qe(t,e,n,r){var i;Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<10&&Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10&&(i=Je.getKookitConfig("chapterTitle"),(i=Fe.findIndex(e,{label:i}))!==e.length-1&&(Je.setKookitConfig("chapterTitle",e[(i=-1===i?0:i)+1].label),an(e[i+1].label,n,t,r),un(t,r),cn(t,r),sn(t,r)))}function tn(e,n){if(!rn){for(var t=Array.from(window.frames[0].document.body.getElementsByTagName("*")).filter(function(t){return on(e,t,n)})[0],r=0,i=Array.from(window.frames[0].document.body.getElementsByTagName("*")),o=0;o<i.length;o++)if(on(e,i[o],n)&&i[o].innerHTML===t.innerHTML){r=o;break}Je.setKookitConfig("text",t?t.innerText:""),Je.setKookitConfig("count",r+""),rn=!0,setTimeout(function(){rn=!1},100)}}function en(t,e){"continuous"!==e&&window.frames[0].document.body.setAttribute("style","width: auto;\n    height: 100%;\n    overflow-y: hidden;\n    overflow-X: hidden;\n    padding-left: 0px;\n    padding-right: 0px;\n    margin: 0px !important;\n    box-sizing: border-box;\n    max-width: inherit;\n    column-fill: auto;\n    column-gap: 88px;\n    column-count: 12;\n    column-width: "+(t.offsetWidth-88)/("double"===e?2:1)+"px;")}function nn(t,e){console.log(window.frames[0].document.body.scrollLeft),0<e&&0<window.frames[0].document.body.scrollLeft?window.frames[0].document.body.scrollLeft-=t.offsetWidth+88:e<0&&(window.frames[0].document.body.scrollLeft+=t.offsetWidth+88)}var rn=!1,on=function(t,e,n){var r=!1,i=e.getBoundingClientRect();return"continuous"!==n&&e.innerText.trim()?r=0<=(n=i.left)&&n<=t.offsetWidth:e.innerText.trim()&&(r=(i=i.top)>=t.scrollTop&&i<=t.scrollTop+t.offsetHeight),r},un=function(t,e){var n,r=document.getElementsByTagName("iframe")[0];"continuous"===e?(n=r.contentWindow.document.body,e=r.contentWindow.document.documentElement,r.height=2*Math.max(n.scrollHeight,n.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),setTimeout(function(){var t=document.getElementsByTagName("iframe")[0],e=t.contentWindow.document.body,n=e.lastElementChild,r=e.lastChild,i=e.querySelectorAll("a"),o=e.querySelectorAll("p"),u=e.querySelectorAll("img"),e=i[i.length-1],i=o[o.length-1],o=o[u.length-1],u=i||e||o;Fe.isElement(e)&&Fe.isElement(i)&&(u=e.clientHeight+e.offsetTop>i.clientHeight+i.offsetTop?e:i),Fe.isElement(o)&&o.clientHeight+o.offsetTop>u.clientHeight+u.offsetTop&&(u=o);i=0;(n||u||r)&&(3!==r.nodeType||n||u)&&(3===r.nodeType&&document.createRange&&((o=document.createRange()).selectNodeContents(r),!o.getBoundingClientRect||(o=o.getBoundingClientRect())&&(i=o.bottom-o.top)),t.height=Math.max(Fe.isElement(n)?n.clientHeight+n.offsetTop:0,Fe.isElement(r)?r.clientHeight+r.offsetTop:0,Fe.isElement(u)?u.clientHeight+u.offsetTop:0)+600+(3===r.nodeType?i:0))},500)):r.height=t.offsetHeight},sn=function(t,e){var n=document.getElementsByTagName("iframe")[0];if(n){n=n.contentDocument;if(n)for(var r,i,o="double"===e?2:1,u=0,s=n.getElementsByTagName("img");u<s.length;u++){var a=s[u];a.width&&a.height&&(a.height/a.width>t.offsetHeight/t.offsetWidth?i=(r=t.offsetHeight)*a.width/a.height:r=(i=(t.offsetWidth-88)/o)*a.height/a.width),a.setAttribute("style","max-width: "+i+"px;max-height:"+r+"px")}}},an=function(t,e,n,r){void 0===t&&(t=""),window.frames[0].document.body.innerHTML="",window.frames[0].document.body.innerHTML=e[-1===Fe.findIndex(e,{title:t})?0:Fe.findIndex(e,{title:t})].text,Je.setKookitConfig("chapterTitle",t),un(n,r),sn(n,r),cn(n,r)},cn=function(t,e,n,r){void 0===r&&(r="0");var i,o,u=(n=void 0===n?"":n)||Je.getKookitConfig("text")||"";u?(n=(o=(i=Array.from(window.frames[0].document.body.getElementsByTagName("*"))).filter(function(t){return t.innerText===u}))[0],1<o.length&&(n=i[parseInt(r||Je.getKookitConfig("count")||"0")]),"continuous"!==e?window.frames[0].document.body.scrollTo(u&&n?n.offsetLeft:0,0):t.scrollTo(0,u&&n?n.offsetTop:0)):("continuous"!==e?window.frames[0].document.body:t).scrollTo(0,0)},fn=(hn.prototype.getChapterDoc=function(){for(var t=-1<this.bookStr.indexOf("<mbp:pagebreak>")?this.bookStr.split("<mbp:pagebreak>"):this.bookStr.split("<address> </address>"),e=[],n=[],r="",i=0;i<t.length;i++)!function(t){for(var e,n,r=0<t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b").length,i=t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b"),o=t.querySelectorAll("p"),u=0;u<i.length;u++){var s=e&&("♦"===i[u].innerText.trim()||"●"===i[u].innerText.trim()||"◾"===i[u].innerText.trim()||"◀"===i[u].innerText.trim()||"◼"===i[u].innerText.trim()||"■"===i[u].innerText.trim());if(i[u].innerText.trim()&&!s){e=i[u];break}}for(u=0;u<o.length;u++)if(o[u].innerText.trim()&&-1===o[u].innerHTML.indexOf("<")){n=o[u];break}var a=!0;if(e&&n){for(var c=t.querySelectorAll("*"),f=[],u=0;u<c.length;u++)c[u].innerText&&f.push(c[u].innerText);f.indexOf(n.innerText)<f.indexOf(e.innerText)&&(a=!1)}var h=e&&30<e.innerText.trim().length,t=50<t.body.innerText.length;return r&&(!h||ze(e.innerText.trim()))&&a&&t}((new DOMParser).parseFromString(t[i],"text/html"))?r+=t[i]:(e.push(r+t[i]),r="");for(i=0;i<e.length;i++){for(var o=(new DOMParser).parseFromString(e[i],"text/html").querySelectorAll("h1,h2,h3,h4,blockquote,font,b"),u=void 0,s=0;s<o.length;s++){var a="♦"===o[s].innerText.trim()||"●"===o[s].innerText.trim()||"◾"===o[s].innerText.trim()||"◀"===o[s].innerText.trim()||"◼"===o[s].innerText.trim()||"■"===o[s].innerText.trim();if(o[s].innerText.trim()&&!a){u=o[s];break}}this.chapterDocList.push({title:u?-1===n.indexOf(u.innerText)?u.innerText:u.innerText+"#"+i:"Forword",text:e[i]}),u&&n.push(u.innerText)}return this.chapterDocList},hn.prototype.getChapter=function(){for(var t=0;t<this.chapterDocList.length;t++){var e=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDocList[t].title,id:"title"+e,href:"#title"+e,subitems:[]})}return this.chapterList},hn);function hn(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[]}var ln=(pn.prototype.getChapter=function(){var t;return this.chapterDomList=Array.from(this.bookDoc.querySelectorAll("h1,h2,h3,h4,font,b")),0<this.chapterDomList.length?(this.insertPageBreak(),t=new fn(this.bookDoc.body.innerHTML),this.chapterDocList=t.getChapterDoc(),this.chapterList=t.getChapter()):(this.getExtraTitle(),this.generateChapterList(),this.insertPageBreak()),this.chapterList},pn.prototype.insertPageBreak=function(){for(var t=0;t<this.chapterDomList.length;t++){var e=document.createElement("address"),n=document.createTextNode(" ");e.appendChild(n),this.chapterDomList[t].parentNode&&this.chapterDomList[t].parentNode.insertBefore(e,this.chapterDomList[t])}},pn.prototype.generateChapterList=function(){0===this.chapterDomList.length&&(n=Math.floor(9e5*Math.random())+1e5,this.chapterList.push({label:"Forword",id:"title"+n,href:"#title"+n,subitems:[]}));for(var t=[],e=0;e<this.chapterDomList.length;e++){var n=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDomList[e]?-1===t.lastIndexOf(this.chapterDomList[e].innerText)?this.chapterDomList[e].innerText:t[t.lastIndexOf(this.chapterDomList[e].innerText)]+"#"+e:"Forword",id:"title"+n,href:"#title"+n,subitems:[]}),t.push(this.chapterList[e].label)}},pn.prototype.getExtraTitle=function(){var e=!1;0===this.chapterDomList.length&&(this.chapterDomList=Array.from(this.bookDoc.querySelectorAll("p")).filter(function(t){return!e&&(t.innerText.trim().startsWith("第")&&Ke(t.innerText.trim())||t.innerText.trim().startsWith("Chapter")||t.innerText.trim().startsWith("CHAPTER"))&&(e=!0),ze(t.innerText.trim(),e)}))},pn.prototype.getChapterDoc=function(){if(0<this.chapterDocList.length)return this.chapterDocList;for(var t=this.bookDoc.body.innerHTML.split("<address> </address>"),e=0;e<t.length;e++)t.length===this.chapterList.length?this.chapterDocList.push({title:this.chapterList[e].label,text:t[e]||this.bookStr}):0===e?this.chapterDocList.push({title:"Forword",text:t[e]||this.bookStr}):this.chapterDocList.push({title:this.chapterList[e-1].label,text:t[e]});return this.chapterDocList},pn);function pn(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[],this.bookDoc=(new DOMParser).parseFromString(this.bookStr,"text/html"),this.chapterDomList=[]}dn.prototype.renderTo=function(i){var e=this;return new Promise(function(r,t){return n(e,void 0,void 0,function(){var e,n;return o(this,function(t){return Pe(),this.element=i,n=new ln(this.bookStr),this.chapterList=n.getChapter(),this.chapterDocList=n.getChapterDoc(),e=Je.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,n=-1===Fe.findIndex(this.chapterDocList,{title:e})?0:Fe.findIndex(this.chapterDocList,{title:e}),Ze(i),window.frames[0].document.body.innerHTML=this.chapterDocList[n].text,Je.setKookitConfig("chapterTitle",e),un(i,this.mode),sn(this.element,this.mode),cn(i,this.mode),Ge(i,this.chapterList,this.chapterDocList,this.mode),r(),[2]})})})},dn.prototype.getChapter=function(){return this.chapterList},dn.prototype.goToChapter=function(t){an(t,this.chapterDocList,this.element,this.mode)},dn.prototype.goToPosition=function(t,e,n){an(e,this.chapterDocList,this.element,this.mode),cn(this.element,this.mode,t,n)},dt=dn;function dn(t,e){this.bookStr=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.element=""}function gn(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),new TextDecoder("utf-8").decode(t)}var mn=new DOMParser,vn=(yn.prototype.write=function(t){this.cur_fragment.write(t)||(this.cur_fragment=new bn(this.capacity),this.fragment_list.push(this.cur_fragment),this.cur_fragment.write(t))},yn.prototype.get=function(t){for(var e=0;e<this.fragment_list.length;){var n=this.fragment_list[e];if(t<n.size)return n.get(t);t-=n.size,e+=1}return null},yn.prototype.size=function(){for(var t=0,e=0;e<this.fragment_list.length;e++)t+=this.fragment_list[e].size;return t},yn.prototype.shrink=function(){for(var t=new Uint8Array(this.size()),e=0,n=0;n<this.fragment_list.length;n++){var r=this.fragment_list[n];r.full()?t.set(r.buffer,e):t.set(r.buffer.slice(0,r.size),e),e+=r.size}return t},yn);function yn(t){this.capacity=t,this.fragment_list=[],this.imageArray=[],this.cur_fragment=new bn(t),this.fragment_list.push(this.cur_fragment)}var bn=(xn.prototype.write=function(t){return!(this.size>=this.capacity)&&(this.buffer[this.size]=t,this.size+=1,!0)},xn.prototype.full=function(){return this.size===this.capacity},xn.prototype.get=function(t){return this.buffer[t]},xn);function xn(t){this.buffer=new Uint8Array(t),this.capacity=t,this.size=0}var wn=(Ln.prototype.parse=function(){},Ln.prototype.getUint8=function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},Ln.prototype.getUint16=function(){var t=this.view.getUint16(this.offset);return this.offset+=2,t},Ln.prototype.getUint32=function(){var t=this.view.getUint32(this.offset);return this.offset+=4,t},Ln.prototype.getStr=function(t){var e=gn(this.buffer.slice(this.offset,this.offset+t));return this.offset+=t,e},Ln.prototype.skip=function(t){this.offset+=t},Ln.prototype.setoffset=function(t){this.offset=t},Ln.prototype.get_record_extrasize=function(t,e){for(var n,r,i,o=t.length-1,u=0,s=15;0<s;s--)e&1<<s&&(r=(n=this.buffer_get_varlen(t,o))[0],i=n[1],o=n[2],o-=r-i,u+=r);return 1&e&&(u+=1+(3&t[o])),u},Ln.prototype.buffer_get_varlen=function(t,e){for(var n=0,r=0,i=0,o=0;;0){var u=t[e];if(r|=(127&u)<<o,o+=7,n+=1,--e,4<=(i+=1)||0<(128&u))break}return[r,n,e]},Ln.prototype.read_text=function(){for(var t=this.palm_header.record_count,e=[],n=1;n<=t;n++)e.push(this.read_text_record(n));return gn(function(t){for(var e=0,n=0;n<t.length;n++){var r=t[n];e+=r.length}for(var i=new Uint8Array(e),o=0,n=0;n<t.length;n++)r=t[n],i.set(r,o),o+=r.length;return i}(e))},Ln.prototype.read_text_record=function(t){var e=this.mobi_header.extra_flags,n=this.reclist[t].offset,r=this.reclist[t+1].offset,t=new Uint8Array(this.buffer.slice(n,r)),e=this.get_record_extrasize(t,e),t=new Uint8Array(this.buffer.slice(n,r-e));return 2!==this.palm_header.compression?t:function(t){for(var e=t.length,n=0,r=new vn(t.length);n<e;){var i=t[n];if(n+=1,0===i)r.write(i);else if(i<=8){for(var o=n;o<n+i;o++)r.write(t[o]);n+=i}else if(i<=127)r.write(i);else if(i<=191){var u=t[n];n+=1;for(var s=(i<<8|u)>>3&2047,a=3+(7&u),c=r.size(),f=0;f<a;f++)r.write(r.get(c-s)),c+=1}else r.write(32),r.write(128^i)}return r}(t).shrink()},Ln.prototype.read_image=function(t){var e=this.mobi_header.first_image_idx,n=this.reclist[e+t].offset,t=this.reclist[e+t+1].offset,t=new Uint8Array(this.buffer.slice(n,t));return new Blob([t.buffer])},Ln.prototype.load=function(){this.header=this.load_pdbheader(),this.reclist=this.load_reclist(),this.load_record0()},Ln.prototype.load_pdbheader=function(){var t={};return t.name=this.getStr(32),t.attr=this.getUint16(),t.version=this.getUint16(),t.ctime=this.getUint32(),t.mtime=this.getUint32(),t.btime=this.getUint32(),t.mod_num=this.getUint32(),t.appinfo_offset=this.getUint32(),t.sortinfo_offset=this.getUint32(),t.type=this.getStr(4),t.creator=this.getStr(4),t.uid=this.getUint32(),t.next_rec=this.getUint32(),t.record_num=this.getUint16(),t},Ln.prototype.load_reclist=function(){for(var t=[],e=0;e<this.header.record_num;e++){var n={};n.offset=this.getUint32(),n.attr=this.getUint32(),t.push(n)}return t},Ln.prototype.load_record0=function(){this.palm_header=this.load_record0_header(),this.mobi_header=this.load_mobi_header()},Ln.prototype.load_record0_header=function(){var t={},e=this.reclist[0];return this.setoffset(e.offset),t.compression=this.getUint16(),this.skip(2),t.text_length=this.getUint32(),t.record_count=this.getUint16(),t.record_size=this.getUint16(),t.encryption_type=this.getUint16(),this.skip(2),t},Ln.prototype.load_mobi_header=function(){var t={},e=this.offset;return t.identifier=this.getUint32(),t.header_length=this.getUint32(),t.mobi_type=this.getUint32(),t.text_encoding=this.getUint32(),t.uid=this.getUint32(),t.generator_version=this.getUint32(),this.skip(40),t.first_nonbook_index=this.getUint32(),t.full_name_offset=this.getUint32(),t.full_name_length=this.getUint32(),t.language=this.getUint32(),t.input_language=this.getUint32(),t.output_language=this.getUint32(),t.min_version=this.getUint32(),t.first_image_idx=this.getUint32(),t.huff_rec_index=this.getUint32(),t.huff_rec_count=this.getUint32(),t.datp_rec_index=this.getUint32(),t.datp_rec_count=this.getUint32(),t.exth_flags=this.getUint32(),this.skip(36),t.drm_offset=this.getUint32(),t.drm_count=this.getUint32(),t.drm_size=this.getUint32(),t.drm_flags=this.getUint32(),this.skip(8),this.skip(4),this.skip(46),t.extra_flags=this.getUint16(),this.setoffset(e+t.header_length),t},Ln.prototype.load_exth_header=function(){return{}},Ln.prototype.extractContent=function(t){var e=document.createElement("span");return e.innerHTML=t,e.textContent||e.innerText},Ln.prototype.render=function(){var e=this;return new Promise(function(i,t){return n(e,void 0,void 0,function(){var e,n,r;return o(this,function(t){switch(t.label){case 0:this.load(),r=this.read_text(),e=mn.parseFromString(r,"text/html").documentElement,n=e.getElementsByTagName("img"),r=0,t.label=1;case 1:return r<n.length?[4,this.render_image(n,r)]:[3,4];case 2:t.sent(),t.label=3;case 3:return r++,[3,1];case 4:return i(e),[2]}})})})},Ln);function Ln(t){var s=this;this.render_image=function(o,u){return new Promise(function(n,e){var r=o[u],t=+r.getAttribute("recindex"),i=s.read_image(t-1),t=new FileReader;t.onload=function(t){var e;r.src=null===(e=t.target)||void 0===e?void 0:e.result,n(null===(t=t.target)||void 0===t?void 0:t.result)},t.onerror=function(t){e(t)},t.readAsDataURL(i)})},this.view=new DataView(t),this.buffer=this.view.buffer,this.offset=0,this.header=null}_n.prototype.renderTo=function(i){return n(this,void 0,void 0,function(){var e=this;return o(this,function(t){return[2,new Promise(function(r,t){return n(e,void 0,void 0,function(){var e,n;return o(this,function(t){switch(t.label){case 0:return Pe(),[4,new wn(this.azw3Buffer).render()];case 1:return n=t.sent(),e=n.outerHTML,this.bookStr=e,this.element=i,n=new ln(this.bookStr),this.chapterList=n.getChapter(),this.chapterDocList=n.getChapterDoc(),e=Je.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,n=-1===Fe.findIndex(this.chapterDocList,{title:e})?0:Fe.findIndex(this.chapterDocList,{title:e}),Ze(i),window.frames[0].document.body.innerHTML=this.chapterDocList[n].text,Je.setKookitConfig("chapterTitle",e),un(i,this.mode),sn(this.element,this.mode),cn(i,this.mode),Ge(i,this.chapterList,this.chapterDocList,this.mode),r(),[2]}})})})]})})},_n.prototype.getChapter=function(){return this.chapterList},_n.prototype.goToChapter=function(t){an(t,this.chapterDocList,this.element,this.mode)},_n.prototype.goToPosition=function(t,e,n){an(e,this.chapterDocList,this.element,this.mode),cn(this.element,this.mode,t,n)},F=_n;function _n(t,e){this.azw3Buffer=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}Tn.prototype.renderTo=function(i){var e=this;return new Promise(function(r,t){return n(e,void 0,void 0,function(){var e,n;return o(this,function(t){switch(t.label){case 0:return Pe(),[4,new wn(this.mobiBuffer).render()];case 1:return n=t.sent(),e=n.outerHTML,this.bookStr=e,this.element=i,n=new fn(this.bookStr),this.chapterDocList=n.getChapterDoc(),this.chapterList=n.getChapter(),e=Je.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,n=-1===Fe.findIndex(this.chapterDocList,{title:e})?0:Fe.findIndex(this.chapterDocList,{title:e}),Ze(i),window.frames[0].document.body.innerHTML=this.chapterDocList[n].text,Je.setKookitConfig("chapterTitle",e),en(i,this.mode),un(i,this.mode),sn(this.element,this.mode),cn(i,this.mode),Ge(i,this.chapterList,this.chapterDocList,this.mode),r(),[2]}})})})},Tn.prototype.getChapter=function(){return this.chapterList},Tn.prototype.goToChapter=function(t){an(t,this.chapterDocList,this.element,this.mode)},Tn.prototype.goToPosition=function(t,e,n){an(e,this.chapterDocList,this.element,this.mode),cn(this.element,this.mode,t,n)},mt=Tn;function Tn(t,e){this.mobiBuffer=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}var Dn=(kn.prototype.getChapter=function(){var t=[];this.chapterDomList=Array.from(this.bookDoc.querySelectorAll("h1"));for(var e=0;e<this.chapterDomList.length;e++){var n=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDomList[e]?-1===t.lastIndexOf(this.chapterDomList[e].innerText)?this.chapterDomList[e].innerText:t[t.lastIndexOf(this.chapterDomList[e].innerText)]+"#"+e:"Forword",id:"title"+n,href:"#title"+n,subitems:[]}),t.push(this.chapterList[e].label)}for(e=0;e<this.chapterDomList.length;e++){this.chapterDomList[e].id=this.chapterList[e].id;var r=document.createElement("span"),i=document.createTextNode("pagebreak");r.appendChild(i),this.chapterDomList[e].parentNode.insertBefore(r,this.chapterDomList[e])}return this.chapterList},kn.prototype.getChapterDoc=function(){for(var t=this.bookDoc.body.innerHTML.split("<span>pagebreak</span>"),e=[],n=0;n<t.length;n++)t.length===this.chapterList.length?e.push({title:this.chapterList[n].label,text:t[n]}):0===n?e.push({title:"Forword",text:t[n]}):e.push({title:this.chapterList[n-1].label,text:t[n]});return e},kn);function kn(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[],this.bookDoc=(new DOMParser).parseFromString(this.bookStr,"text/html"),this.chapterDomList=[]}An.prototype.renderTo=function(i){var e=this;return new Promise(function(r,t){return n(e,void 0,void 0,function(){var e,n;return o(this,function(t){return Pe(),n=new TextDecoder(this.encoding).decode(this.txtBuffer),e=function(t){for(var e="",n=!1,r=0,i=t.split("\n");r<i.length;r++){var o=i[r];o.trim()&&(ze(o.trim(),n)?((o.trim().startsWith("第")||o.trim().startsWith("Chapter")||o.trim().startsWith("CHAPTER"))&&(n=!0),e+="<h1>"+o+"</h1>"):e+="<p>"+o+"</p>")}return e}(n),this.bookStr=e,this.element=i,n=new Dn(this.bookStr),this.chapterList=n.getChapter(),this.chapterDocList=n.getChapterDoc(),e=Je.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,n=-1===Fe.findIndex(this.chapterDocList,{title:e})?0:Fe.findIndex(this.chapterDocList,{title:e}),Ze(i),window.frames[0].document.body.innerHTML=this.chapterDocList[n].text,Je.setKookitConfig("chapterTitle",e),en(i,this.mode),un(i,this.mode),cn(i,this.mode),Ge(i,this.chapterList,this.chapterDocList,this.mode),r(),[2]})})})},An.prototype.getChapter=function(){return this.chapterList},An.prototype.goToChapter=function(t){an(t,this.chapterDocList,this.element,this.mode)},An.prototype.goToPosition=function(t,e,n){an(e,this.chapterDocList,this.element,this.mode),cn(this.element,this.mode,t,n)},$t=An;function An(t,e,n){void 0===n&&(n="utf-8"),this.txtBuffer=t,this.encoding=n,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}t.Azw3Render=F,t.MobiRender=mt,t.StrRender=dt,t.TxtRender=$t,Object.defineProperty(t,"__esModule",{value:!0})});
