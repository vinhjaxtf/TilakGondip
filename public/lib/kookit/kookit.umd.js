!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Kookit={})}(this,function(t){"use strict";function n(t,o,a,h){return new(a=a||Promise)(function(i,e){function r(t){try{s(h.next(t))}catch(t){e(t)}}function n(t){try{s(h.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,n)}s((h=h.apply(t,o||[])).next())})}class o{static getKookitConfig(t){return(JSON.parse(localStorage.getItem("kookitConfig"))||{})[t]}static setKookitConfig(t,e){let i=JSON.parse(localStorage.getItem("kookitConfig"))||{};i[t]=e,localStorage.setItem("kookitConfig",JSON.stringify(i))}static removeKookitConfig(){localStorage.removeItem("kookitConfig")}}let r=["章","节","回","節","卷","部","輯","辑","話","集","话","篇"];String.prototype.contains=function(t){return-1<this.indexOf(t)};const a=(t,e=!1)=>t&&!t.contains("[")&&!t.contains("(")&&!t.contains("。")&&!t.contains("“")&&!t.contains("‘")&&!t.contains("；")&&!t.contains(";")&&!t.contains("…")&&(t.startsWith("CHAPTER")||t.startsWith("Chapter")||t.startsWith("序章")||t.startsWith("前言")||t.startsWith("声明")||t.startsWith("聲明")||t.startsWith("写在前面的话")||t.startsWith("后记")||t.startsWith("楔子")||t.startsWith("后序")||t.startsWith("寫在前面的話")||t.startsWith("後記")||t.startsWith("後序")||t.startsWith("第")&&i(t)||t.startsWith("卷")&&s(t)||!e&&t.contains("第")&&(" "===t[t.indexOf("第")-1]||"　"===t[t.indexOf("第")-1]||"、"===t[t.indexOf("第")-1]||"："===t[t.indexOf("第")-1]||":"===t[t.indexOf("第")-1])&&i(t.substr(t.indexOf("第")))||!e&&t.indexOf(" ")&&h(t)||!e&&t.indexOf("　")&&h(t)||!e&&t.indexOf("、")&&c(t)||!e&&t.indexOf("：")&&l(t)||!e&&t.indexOf(":")&&l(t)),i=e=>{let i=!1;for(let t=0;t<r.length&&(!(-1<e.indexOf(r[t])&&(" "===e[e.indexOf(r[t])+1]||"　"===e[e.indexOf(r[t])+1]||"、"===e[e.indexOf(r[t])+1]||"："===e[e.indexOf(r[t])+1]||-1<e.indexOf("章")||":"===e[e.indexOf(r[t])+1]))&&e[e.indexOf(r[t])+1]||((/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(e.substring(1,e.indexOf(r[t])).trim())||/^\d+$/.test(e.substring(1,e.indexOf(r[t])).trim()))&&(i=!0),!i));t++);return i},s=t=>!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf(" ")))&&!/^\d+$/.test(t.substring(1,t.indexOf(" "))))||(!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf("　")))&&!/^\d+$/.test(t.substring(1,t.indexOf("　"))))||!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1))&&!/^\d+$/.test(t.substring(1)))),h=t=>!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf(" ")))||(!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("　")))||(!!/^\d+$/.test(t.substring(0,t.indexOf(" ")))||!!/^\d+$/.test(t.substring(0,t.indexOf("　"))))),l=t=>!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf(":")))||(!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("：")))||(!!/^\d+$/.test(t.substring(0,t.indexOf(":")))||!!/^\d+$/.test(t.substring(0,t.indexOf("："))))),c=t=>!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("、")))||!!/^\d+$/.test(t.substring(0,t.indexOf("、")));var u=window;var e=window.atob("ZG8gUmU=");String.prototype.c=function(t){return-1<this.indexOf(t)};const f=()=>n(void 0,void 0,void 0,function*(){o.removeKookitConfig();let t=yield new Promise((t,e)=>{t(u.e(u.a("ZG9jdW1lbnQudGl0bGU=")))});return!!t.c(e)});var d="1.13.1",m="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},g=Array.prototype,p=Object.prototype,b="undefined"!=typeof Symbol?Symbol.prototype:null,v=g.push,y=g.slice,w=p.toString,x=p.hasOwnProperty,L="undefined"!=typeof ArrayBuffer,k="undefined"!=typeof DataView,T=Array.isArray,_=Object.keys,D=Object.create,S=L&&ArrayBuffer.isView,C=isNaN,O=isFinite,A=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],U=Math.pow(2,53)-1;function E(n,s){return s=null==s?n.length-1:+s,function(){for(var t=Math.max(arguments.length-s,0),e=Array(t),i=0;i<t;i++)e[i]=arguments[i+s];switch(s){case 0:return n.call(this,e);case 1:return n.call(this,arguments[0],e);case 2:return n.call(this,arguments[0],arguments[1],e)}for(var r=Array(s+1),i=0;i<s;i++)r[i]=arguments[i];return r[s]=e,n.apply(this,r)}}function I(t){var e=typeof t;return"function"==e||"object"==e&&!!t}function j(t){return void 0===t}function N(t){return!0===t||!1===t||"[object Boolean]"===w.call(t)}function W(t){var e="[object "+t+"]";return function(t){return w.call(t)===e}}var B=W("String"),z=W("Number"),H=W("Date"),P=W("RegExp"),K=W("Error"),$=W("Symbol"),R=W("ArrayBuffer"),F=W("Function"),q=m.document&&m.document.childNodes,V=F="function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof q?function(t){return"function"==typeof t||!1}:F,G=W("Object"),J=k&&G(new DataView(new ArrayBuffer(8))),Z="undefined"!=typeof Map&&G(new Map),Q=W("DataView");var X=J?function(t){return null!=t&&V(t.getInt8)&&R(t.buffer)}:Q,Y=T||W("Array");function tt(t,e){return null!=t&&x.call(t,e)}var et=W("Arguments");!function(){et(arguments)||(et=function(t){return tt(t,"callee")})}();var it=et;function rt(t){return z(t)&&C(t)}function nt(t){return function(){return t}}function st(e){return function(t){t=e(t);return"number"==typeof t&&0<=t&&t<=U}}function ot(e){return function(t){return null==t?void 0:t[e]}}var at=ot("byteLength"),ht=st(at),lt=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var ct=L?function(t){return S?S(t)&&!X(t):ht(t)&&lt.test(w.call(t))}:nt(!1),ut=ot("length");function ft(t,e){e=function(e){for(var i={},t=e.length,r=0;r<t;++r)i[e[r]]=!0;return{contains:function(t){return i[t]},push:function(t){return i[t]=!0,e.push(t)}}}(e);var i=M.length,r=t.constructor,n=V(r)&&r.prototype||p,s="constructor";for(tt(t,s)&&!e.contains(s)&&e.push(s);i--;)(s=M[i])in t&&t[s]!==n[s]&&!e.contains(s)&&e.push(s)}function dt(t){if(!I(t))return[];if(_)return _(t);var e,i=[];for(e in t)tt(t,e)&&i.push(e);return A&&ft(t,i),i}function mt(t,e){var i=dt(e),r=i.length;if(null==t)return!r;for(var n=Object(t),s=0;s<r;s++){var o=i[s];if(e[o]!==n[o]||!(o in n))return!1}return!0}function gt(t){return t instanceof gt?t:this instanceof gt?void(this._wrapped=t):new gt(t)}function pt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,at(t))}gt.VERSION=d,gt.prototype.valueOf=gt.prototype.toJSON=gt.prototype.value=function(){return this._wrapped},gt.prototype.toString=function(){return String(this._wrapped)};var bt="[object DataView]";function vt(t,e,i,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var n=typeof t;return("function"==n||"object"==n||"object"==typeof e)&&function t(e,i,r,n){e instanceof gt&&(e=e._wrapped);i instanceof gt&&(i=i._wrapped);var s=w.call(e);if(s!==w.call(i))return!1;if(J&&"[object Object]"==s&&X(e)){if(!X(i))return!1;s=bt}switch(s){case"[object RegExp]":case"[object String]":return""+e==""+i;case"[object Number]":return+e!=+e?+i!=+i:0==+e?1/+e==1/i:+e==+i;case"[object Date]":case"[object Boolean]":return+e==+i;case"[object Symbol]":return b.valueOf.call(e)===b.valueOf.call(i);case"[object ArrayBuffer]":case bt:return t(pt(e),pt(i),r,n)}var o="[object Array]"===s;if(!o&&ct(e)){var a=at(e);if(a!==at(i))return!1;if(e.buffer===i.buffer&&e.byteOffset===i.byteOffset)return!0;o=!0}if(!o){if("object"!=typeof e||"object"!=typeof i)return!1;s=e.constructor,a=i.constructor;if(s!==a&&!(V(s)&&s instanceof s&&V(a)&&a instanceof a)&&"constructor"in e&&"constructor"in i)return!1}r=r||[];n=n||[];var h=r.length;for(;h--;)if(r[h]===e)return n[h]===i;r.push(e);n.push(i);if(o){if((h=e.length)!==i.length)return!1;for(;h--;)if(!vt(e[h],i[h],r,n))return!1}else{var l,c=dt(e);if(h=c.length,dt(i).length!==h)return!1;for(;h--;)if(l=c[h],!tt(i,l)||!vt(e[l],i[l],r,n))return!1}r.pop();n.pop();return!0}(t,e,i,r)}function yt(t){if(!I(t))return[];var e,i=[];for(e in t)i.push(e);return A&&ft(t,i),i}function wt(r){var n=ut(r);return function(t){if(null==t)return!1;var e=yt(t);if(ut(e))return!1;for(var i=0;i<n;i++)if(!V(t[r[i]]))return!1;return r!==_t||!V(t[xt])}}var xt="forEach",Lt=["clear","delete"],kt=["get","has","set"],Tt=Lt.concat(xt,kt),_t=Lt.concat(kt),Dt=["add"].concat(Lt,xt,"has"),St=Z?wt(Tt):W("Map"),Ct=Z?wt(_t):W("WeakMap"),Ot=Z?wt(Dt):W("Set"),At=W("WeakSet");function Mt(t){for(var e=dt(t),i=e.length,r=Array(i),n=0;n<i;n++)r[n]=t[e[n]];return r}function Ut(t){for(var e={},i=dt(t),r=0,n=i.length;r<n;r++)e[t[i[r]]]=i[r];return e}function Et(t){var e,i=[];for(e in t)V(t[e])&&i.push(e);return i.sort()}function It(h,l){return function(t){var e=arguments.length;if(l&&(t=Object(t)),e<2||null==t)return t;for(var i=1;i<e;i++)for(var r=arguments[i],n=h(r),s=n.length,o=0;o<s;o++){var a=n[o];l&&void 0!==t[a]||(t[a]=r[a])}return t}}var jt=It(yt),Nt=It(dt),Wt=It(yt,!0);function Bt(t){if(!I(t))return{};if(D)return D(t);var e=function(){};e.prototype=t;t=new e;return e.prototype=null,t}function zt(t){return I(t)?Y(t)?t.slice():jt({},t):t}function Ht(t){return Y(t)?t:[t]}function Pt(t){return gt.toPath(t)}function Kt(t,e){for(var i=e.length,r=0;r<i;r++){if(null==t)return;t=t[e[r]]}return i?t:void 0}function $t(t,e,i){e=Kt(t,Pt(e));return j(e)?i:e}function Rt(t){return t}function Ft(e){return e=Nt({},e),function(t){return mt(t,e)}}function qt(e){return e=Pt(e),function(t){return Kt(t,e)}}function Vt(n,s,t){if(void 0===s)return n;switch(null==t?3:t){case 1:return function(t){return n.call(s,t)};case 3:return function(t,e,i){return n.call(s,t,e,i)};case 4:return function(t,e,i,r){return n.call(s,t,e,i,r)}}return function(){return n.apply(s,arguments)}}function Gt(t,e,i){return null==t?Rt:V(t)?Vt(t,e,i):(I(t)&&!Y(t)?Ft:qt)(t)}function Jt(t,e){return Gt(t,e,1/0)}function Zt(t,e,i){return gt.iteratee!==Jt?gt.iteratee(t,e):Gt(t,e,i)}function Qt(){}function Xt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}gt.toPath=Ht,gt.iteratee=Jt;var Yt=Date.now||function(){return(new Date).getTime()};function te(e){function i(t){return e[t]}var t="(?:"+dt(e).join("|")+")",r=RegExp(t),n=RegExp(t,"g");return function(t){return r.test(t=null==t?"":""+t)?t.replace(n,i):t}}var ee={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ie=te(ee),re=te(Ut(ee)),ne=gt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},se=/(.)^/,oe={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},ae=/\\|'|\r|\n|\u2028|\u2029/g;function he(t){return"\\"+oe[t]}var le=/^\s*(\w|\$)+\s*$/;var ce=0;function ue(t,e,i,r,n){if(!(r instanceof e))return t.apply(i,n);i=Bt(t.prototype),n=t.apply(i,n);return I(n)?n:i}var fe=E(function(n,s){function o(){for(var t=0,e=s.length,i=Array(e),r=0;r<e;r++)i[r]=s[r]===a?arguments[t++]:s[r];for(;t<arguments.length;)i.push(arguments[t++]);return ue(n,o,this,this,i)}var a=fe.placeholder;return o});fe.placeholder=gt;var de=E(function(e,i,r){if(!V(e))throw new TypeError("Bind must be called on a function");var n=E(function(t){return ue(e,n,i,this,r.concat(t))});return n}),me=st(ut);function ge(t,e,i,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var n=r.length,s=0,o=ut(t);s<o;s++){var a=t[s];if(me(a)&&(Y(a)||it(a)))if(1<e)ge(a,e-1,i,r),n=r.length;else for(var h=0,l=a.length;h<l;)r[n++]=a[h++];else i||(r[n++]=a)}return r}var pe=E(function(t,e){var i=(e=ge(e,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var r=e[i];t[r]=de(t[r],t)}return t});var be=E(function(t,e,i){return setTimeout(function(){return t.apply(null,i)},e)}),ve=fe(be,gt,1);function ye(t){return function(){return!t.apply(this,arguments)}}function we(t,e){var i;return function(){return 0<--t&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}}m=fe(we,2);function xe(t,e,i){e=Zt(e,i);for(var r,n=dt(t),s=0,o=n.length;s<o;s++)if(e(t[r=n[s]],r,t))return r}function Le(s){return function(t,e,i){e=Zt(e,i);for(var r=ut(t),n=0<s?0:r-1;0<=n&&n<r;n+=s)if(e(t[n],n,t))return n;return-1}}var ke=Le(1),q=Le(-1);function Te(t,e,i,r){for(var n=(i=Zt(i,r,1))(e),s=0,o=ut(t);s<o;){var a=Math.floor((s+o)/2);i(t[a])<n?s=a+1:o=a}return s}function _e(s,o,a){return function(t,e,i){var r=0,n=ut(t);if("number"==typeof i)0<s?r=0<=i?i:Math.max(i+n,r):n=0<=i?Math.min(i+1,n):i+n+1;else if(a&&i&&n)return t[i=a(t,e)]===e?i:-1;if(e!=e)return 0<=(i=o(y.call(t,r,n),rt))?i+r:-1;for(i=0<s?r:n-1;0<=i&&i<n;i+=s)if(t[i]===e)return i;return-1}}var De=_e(1,ke,Te),F=_e(-1,q);function Se(t,e,i){i=(me(t)?ke:xe)(t,e,i);if(void 0!==i&&-1!==i)return t[i]}function Ce(t,e,i){if(e=Vt(e,i),me(t))for(n=0,s=t.length;n<s;n++)e(t[n],n,t);else for(var r=dt(t),n=0,s=r.length;n<s;n++)e(t[r[n]],r[n],t);return t}function Oe(t,e,i){e=Zt(e,i);for(var r=!me(t)&&dt(t),n=(r||t).length,s=Array(n),o=0;o<n;o++){var a=r?r[o]:o;s[o]=e(t[a],a,t)}return s}function Ae(h){return function(t,e,i,r){var n=3<=arguments.length;return function(t,e,i,r){var n=!me(t)&&dt(t),s=(n||t).length,o=0<h?0:s-1;for(r||(i=t[n?n[o]:o],o+=h);0<=o&&o<s;o+=h){var a=n?n[o]:o;i=e(i,t[a],a,t)}return i}(t,Vt(e,r,4),i,n)}}k=Ae(1),G=Ae(-1);function Me(t,r,e){var n=[];return r=Zt(r,e),Ce(t,function(t,e,i){r(t,e,i)&&n.push(t)}),n}function Ue(t,e,i){e=Zt(e,i);for(var r=!me(t)&&dt(t),n=(r||t).length,s=0;s<n;s++){var o=r?r[s]:s;if(!e(t[o],o,t))return!1}return!0}function Ee(t,e,i){e=Zt(e,i);for(var r=!me(t)&&dt(t),n=(r||t).length,s=0;s<n;s++){var o=r?r[s]:s;if(e(t[o],o,t))return!0}return!1}function Ie(t,e,i,r){return me(t)||(t=Mt(t)),0<=De(t,e,i="number"!=typeof i||r?0:i)}Q=E(function(t,i,r){var n,s;return V(i)?s=i:(i=Pt(i),n=i.slice(0,-1),i=i[i.length-1]),Oe(t,function(t){var e=s;if(!e){if(null==(t=n&&n.length?Kt(t,n):t))return;e=t[i]}return null==e?e:e.apply(t,r)})});function je(t,e){return Oe(t,qt(e))}function Ne(t,r,e){var i,n,s=-1/0,o=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var a=0,h=(t=me(t)?t:Mt(t)).length;a<h;a++)null!=(i=t[a])&&s<i&&(s=i);else r=Zt(r,e),Ce(t,function(t,e,i){n=r(t,e,i),(o<n||n===-1/0&&s===-1/0)&&(s=t,o=n)});return s}function We(t,e,i){if(null==e||i)return(t=!me(t)?Mt(t):t)[Xt(t.length-1)];var r=(me(t)?zt:Mt)(t),t=ut(r);e=Math.max(Math.min(e,t),0);for(var n=t-1,s=0;s<e;s++){var o=Xt(s,n),a=r[s];r[s]=r[o],r[o]=a}return r.slice(0,e)}function Be(s,e){return function(i,r,t){var n=e?[[],[]]:{};return r=Zt(r,t),Ce(i,function(t,e){e=r(t,e,i);s(n,t,e)}),n}}var T=Be(function(t,e,i){tt(t,i)?t[i].push(e):t[i]=[e]}),L=Be(function(t,e,i){t[i]=e}),kt=Be(function(t,e,i){tt(t,i)?t[i]++:t[i]=1}),Lt=Be(function(t,e,i){t[i?0:1].push(e)},!0),ze=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function He(t,e,i){return e in i}var Pe=E(function(t,e){var i={},r=e[0];if(null==t)return i;V(r)?(1<e.length&&(r=Vt(r,e[1])),e=yt(t)):(r=He,e=ge(e,!1,!1),t=Object(t));for(var n=0,s=e.length;n<s;n++){var o=e[n],a=t[o];r(a,o,t)&&(i[o]=a)}return i}),Tt=E(function(t,i){var e,r=i[0];return V(r)?(r=ye(r),1<i.length&&(e=i[1])):(i=Oe(ge(i,!1,!1),String),r=function(t,e){return!Ie(i,e)}),Pe(t,r,e)});function Ke(t,e,i){return y.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))}function $e(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[0]:Ke(t,t.length-e)}function Re(t,e,i){return y.call(t,null==e||i?1:e)}var Fe=E(function(t,e){return e=ge(e,!0,!0),Me(t,function(t){return!Ie(e,t)})}),Z=E(function(t,e){return Fe(t,e)});function qe(t,e,i,r){N(e)||(r=i,i=e,e=!1),null!=i&&(i=Zt(i,r));for(var n=[],s=[],o=0,a=ut(t);o<a;o++){var h=t[o],l=i?i(h,o,t):h;e&&!i?(o&&s===l||n.push(h),s=l):i?Ie(s,l)||(s.push(l),n.push(h)):Ie(n,h)||n.push(h)}return n}Dt=E(function(t){return qe(ge(t,!0,!0))});function Ve(t){for(var e=t&&Ne(t,ut).length||0,i=Array(e),r=0;r<e;r++)i[r]=je(t,r);return i}ee=E(Ve);function Ge(t,e){return t._chain?gt(e).chain():e}function Je(i){return Ce(Et(i),function(t){var e=gt[t]=i[t];gt.prototype[t]=function(){var t=[this._wrapped];return v.apply(t,arguments),Ge(this,e.apply(gt,t))}}),gt}Ce(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var i=g[e];gt.prototype[e]=function(){var t=this._wrapped;return null!=t&&(i.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0]),Ge(this,t)}}),Ce(["concat","join","slice"],function(t){var e=g[t];gt.prototype[t]=function(){var t=this._wrapped;return Ge(this,t=null!=t?e.apply(t,arguments):t)}});var Ze=Je(Object.freeze({__proto__:null,VERSION:d,restArguments:E,isObject:I,isNull:function(t){return null===t},isUndefined:j,isBoolean:N,isElement:function(t){return!(!t||1!==t.nodeType)},isString:B,isNumber:z,isDate:H,isRegExp:P,isError:K,isSymbol:$,isArrayBuffer:R,isDataView:X,isArray:Y,isFunction:V,isArguments:it,isFinite:function(t){return!$(t)&&O(t)&&!isNaN(parseFloat(t))},isNaN:rt,isTypedArray:ct,isEmpty:function(t){if(null==t)return!0;var e=ut(t);return"number"==typeof e&&(Y(t)||B(t)||it(t))?0===e:0===ut(dt(t))},isMatch:mt,isEqual:function(t,e){return vt(t,e)},isMap:St,isWeakMap:Ct,isSet:Ot,isWeakSet:At,keys:dt,allKeys:yt,values:Mt,pairs:function(t){for(var e=dt(t),i=e.length,r=Array(i),n=0;n<i;n++)r[n]=[e[n],t[e[n]]];return r},invert:Ut,functions:Et,methods:Et,extend:jt,extendOwn:Nt,assign:Nt,defaults:Wt,create:function(t,e){return t=Bt(t),e&&Nt(t,e),t},clone:zt,tap:function(t,e){return e(t),t},get:$t,has:function(t,e){for(var i=(e=Pt(e)).length,r=0;r<i;r++){var n=e[r];if(!tt(t,n))return!1;t=t[n]}return!!i},mapObject:function(t,e,i){e=Zt(e,i);for(var r=dt(t),n=r.length,s={},o=0;o<n;o++){var a=r[o];s[a]=e(t[a],a,t)}return s},identity:Rt,constant:nt,noop:Qt,toPath:Ht,property:qt,propertyOf:function(e){return null==e?Qt:function(t){return $t(e,t)}},matcher:Ft,matches:Ft,times:function(t,e,i){var r=Array(Math.max(0,t));e=Vt(e,i,1);for(var n=0;n<t;n++)r[n]=e(n);return r},random:Xt,now:Yt,escape:ie,unescape:re,templateSettings:ne,template:function(s,t,e){t=Wt({},t=!t&&e?e:t,gt.templateSettings);var i,e=RegExp([(t.escape||se).source,(t.interpolate||se).source,(t.evaluate||se).source].join("|")+"|$","g"),o=0,a="__p+='";if(s.replace(e,function(t,e,i,r,n){return a+=s.slice(o,n).replace(ae,he),o=n+t.length,e?a+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),t}),a+="';\n",e=t.variable){if(!le.test(e))throw new Error("variable is not a bare identifier: "+e)}else a="with(obj||{}){\n"+a+"}\n",e="obj";a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(e,"_",a)}catch(t){throw t.source=a,t}return(t=function(t){return i.call(this,t,gt)}).source="function("+e+"){\n"+a+"}",t},result:function(t,e,i){var r=(e=Pt(e)).length;if(!r)return V(i)?i.call(t):i;for(var n=0;n<r;n++){var s=null==t?void 0:t[e[n]];void 0===s&&(s=i,n=r),t=V(s)?s.call(t):s}return t},uniqueId:function(t){var e=++ce+"";return t?t+e:e},chain:function(t){return(t=gt(t))._chain=!0,t},iteratee:Jt,partial:fe,bind:de,bindAll:pe,memoize:function(i,r){function n(t){var e=n.cache,t=""+(r?r.apply(this,arguments):t);return tt(e,t)||(e[t]=i.apply(this,arguments)),e[t]}return n.cache={},n},delay:be,defer:ve,throttle:function(i,r,n){var s,o,a,h,l=0;function c(){l=!1===n.leading?0:Yt(),s=null,h=i.apply(o,a),s||(o=a=null)}function t(){var t=Yt();l||!1!==n.leading||(l=t);var e=r-(t-l);return o=this,a=arguments,e<=0||r<e?(s&&(clearTimeout(s),s=null),l=t,h=i.apply(o,a),s||(o=a=null)):s||!1===n.trailing||(s=setTimeout(c,e)),h}return n=n||{},t.cancel=function(){clearTimeout(s),l=0,s=o=a=null},t},debounce:function(e,i,r){function n(){var t=Yt()-o;t<i?s=setTimeout(n,i-t):(s=null,r||(h=e.apply(l,a)),s||(a=l=null))}var s,o,a,h,l,t=E(function(t){return l=this,a=t,o=Yt(),s||(s=setTimeout(n,i),r&&(h=e.apply(l,a))),h});return t.cancel=function(){clearTimeout(s),s=a=l=null},t},wrap:function(t,e){return fe(e,t)},negate:ye,compose:function(){var i=arguments,r=i.length-1;return function(){for(var t=r,e=i[r].apply(this,arguments);t--;)e=i[t].call(this,e);return e}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:we,once:m,findKey:xe,findIndex:ke,findLastIndex:q,sortedIndex:Te,indexOf:De,lastIndexOf:F,find:Se,detect:Se,findWhere:function(t,e){return Se(t,Ft(e))},each:Ce,forEach:Ce,map:Oe,collect:Oe,reduce:k,foldl:k,inject:k,reduceRight:G,foldr:G,filter:Me,select:Me,reject:function(t,e,i){return Me(t,ye(Zt(e)),i)},every:Ue,all:Ue,some:Ee,any:Ee,contains:Ie,includes:Ie,include:Ie,invoke:Q,pluck:je,where:function(t,e){return Me(t,Ft(e))},max:Ne,min:function(t,r,e){var i,n,s=1/0,o=1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var a=0,h=(t=me(t)?t:Mt(t)).length;a<h;a++)null!=(i=t[a])&&i<s&&(s=i);else r=Zt(r,e),Ce(t,function(t,e,i){((n=r(t,e,i))<o||n===1/0&&s===1/0)&&(s=t,o=n)});return s},shuffle:function(t){return We(t,1/0)},sample:We,sortBy:function(t,r,e){var n=0;return r=Zt(r,e),je(Oe(t,function(t,e,i){return{value:t,index:n++,criteria:r(t,e,i)}}).sort(function(t,e){var i=t.criteria,r=e.criteria;if(i!==r){if(r<i||void 0===i)return 1;if(i<r||void 0===r)return-1}return t.index-e.index}),"value")},groupBy:T,indexBy:L,countBy:kt,partition:Lt,toArray:function(t){return t?Y(t)?y.call(t):B(t)?t.match(ze):me(t)?Oe(t,Rt):Mt(t):[]},size:function(t){return null==t?0:(me(t)?t:dt(t)).length},pick:Pe,omit:Tt,first:$e,head:$e,take:$e,initial:Ke,last:function(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[t.length-1]:Re(t,Math.max(0,t.length-e))},rest:Re,tail:Re,drop:Re,compact:function(t){return Me(t,Boolean)},flatten:function(t,e){return ge(t,e,!1)},without:Z,uniq:qe,unique:qe,union:Dt,intersection:function(t){for(var e=[],i=arguments.length,r=0,n=ut(t);r<n;r++){var s=t[r];if(!Ie(e,s)){for(var o=1;o<i&&Ie(arguments[o],s);o++);o===i&&e.push(s)}}return e},difference:Fe,unzip:Ve,transpose:Ve,zip:ee,object:function(t,e){for(var i={},r=0,n=ut(t);r<n;r++)e?i[t[r]]=e[r]:i[t[r][0]]=t[r][1];return i},range:function(t,e,i){null==e&&(e=t||0,t=0),i=i||(e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/i),0),n=Array(r),s=0;s<r;s++,t+=i)n[s]=t;return n},chunk:function(t,e){if(null==e||e<1)return[];for(var i=[],r=0,n=t.length;r<n;)i.push(y.call(t,r,r+=e));return i},mixin:Je,default:gt}));Ze._=Ze;const Qe=(t,e)=>{let i=document.getElementsByTagName("iframe")[0];var r;"scroll"===e?(r=i.contentWindow.document.body,e=i.contentWindow.document.documentElement,i.height=2*Math.max(r.scrollHeight,r.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),setTimeout(()=>{let t=document.getElementsByTagName("iframe")[0],e=t.contentWindow.document.body;var i=e.lastElementChild,r=e.lastChild,n=e.getElementsByTagName("a"),s=e.getElementsByTagName("p"),o=e.getElementsByTagName("img"),a=n[n.length-1],n=s[s.length-1],o=s[o.length-1];let h=n||a||o;Ze.isElement(a)&&Ze.isElement(n)&&(h=a.clientHeight+a.offsetTop>n.clientHeight+n.offsetTop?a:n),Ze.isElement(o)&&o.clientHeight+o.offsetTop>h.clientHeight+h.offsetTop&&(h=o);let l=0;if((i||h||r)&&(3!==r.nodeType||i||h)){if(3===r.nodeType&&document.createRange){let t=document.createRange();t.selectNodeContents(r),!t.getBoundingClientRect||(o=t.getBoundingClientRect())&&(l=o.bottom-o.top)}t.height=Math.max(Ze.isElement(i)?i.clientHeight+i.offsetTop:0,Ze.isElement(r)?r.clientHeight+r.offsetTop:0,Ze.isElement(h)?h.clientHeight+h.offsetTop:0)+400+(3===r.nodeType?l:0)}},500)):i.height=t.offsetHeight},Xe=t=>{var e=document.createElement("iframe");e.style.width="100%",e.style.border="0",e.style.margin="0",e.style.padding="0",e.style.fontSize="100%",e.style.font="inherit",e.style.verticalAlign="baseline",t.innerHTML="",t.appendChild(e)},Ye=(e,i)=>{if("scroll"!==i){window.frames[0].document.body.setAttribute("style",`width: auto;
    height: 100%;
    overflow-y: hidden;
    overflow-X: hidden;
    padding-left: 0px;
    padding-right: 0px;
    margin: 0px;
    box-sizing: border-box;
    max-width: inherit;
    column-fill: auto;
    column-gap: 88px;
    column-count: 12;
    column-width: ${(e.offsetWidth-88)/("double"===i?2:1)}px;`);let t=window.frames[0].document.createElement("style");t.id="default-style",t.textContent="p{display: inherit;margin-block-start: inherit;margin-block-end: inherit;margin-inline-start: inherit;margin-inline-end: inherit;}",window.frames[0].document.head.appendChild(t)}};let ti=!1;const ei=(t,e,i,r,n,s,o)=>{0<n&&0<window.frames[0].document.body.scrollLeft?window.frames[0].document.body.scrollBy({top:0,left:-t.offsetWidth-88,behavior:s?"smooth":"auto"}):0<n&&0===window.frames[0].document.body.scrollLeft?(ii(t,e,i,r),o("rendered")):n<0&&(((t,e,i,r,n)=>{if(Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<10&&Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10){oi(t,e,i,r);n("rendered")}})(t,e,i,r,o),window.frames[0].document.body.scrollBy({top:0,left:t.offsetWidth+88,behavior:s?"smooth":"auto"}))},ii=(t,e,i,r)=>{var n=o.getKookitConfig("chapterTitle"),s=Ze.findIndex(e,{label:n});0!==s&&-1!==s&&n&&(o.setKookitConfig("chapterTitle",e[s-1].label),o.setKookitConfig("text","prevChapter"),ri(e[s-1].label,i,t,r))},ri=(t="",e,i,r)=>{window.frames[0].document.body.innerHTML="";let n=Ze.findIndex(e,{title:t});n=-1===n?0:n,window.frames[0].document.body.innerHTML=e[n].text,o.setKookitConfig("chapterTitle",e[n].title),Qe(i,r),(()=>{var r,t=document.getElementsByTagName("iframe")[0];if(t){let i=t.contentDocument;if(i){let t,e;for(r of i.getElementsByTagName("img")){var n=r.parentElement;r.width&&r.height?r.height/r.width>n.clientHeight/n.clientWidth?(t=n.clientHeight,e=t*r.width/r.height):(e=n.clientWidth,t=e*r.height/r.width):e=n.clientWidth,r.setAttribute("style",`max-width: ${e}px;max-height:${t}px`)}}}})(),ni(i,r)},ni=(e,i,r="",n="0")=>{let s=r||o.getKookitConfig("text")||"";if(s){let t=Array.from(window.frames[0].document.body.querySelectorAll("h1,h2,h3,h4,p,img"));r=t.filter((t,e)=>t.innerText===s&&e===parseInt(o.getKookitConfig("count")||n))[0];"scroll"!==i?window.frames[0].document.body.scrollTo(s&&r?r.offsetLeft:"prevChapter"===s?window.frames[0].document.body.scrollWidth:0,0):e.scrollTo(0,s&&r?r.offsetTop:0)}else("scroll"!==i?window.frames[0].document.body:e).scrollTo(0,0)},si=(i,r)=>{if(!ti){var t=Array.from(window.frames[0].document.body.querySelectorAll("h1,h2,h3,h4,p,img")).filter(t=>ai(i,t,r)&&t.innerText.trim()),n=t["scroll"===r?Math.floor(t.length/2):0];let e=0;var s=Array.from(window.frames[0].document.body.querySelectorAll("h1,h2,h3,h4,p,img"));for(let t=0;t<s.length;t++){if(ai(i,s[t],r)){e=t;break}if(ai(i,s[t],r)&&n&&s[t].innerHTML===n.innerHTML&&"IMG"!==s[t].tagName){e=t;break}}o.setKookitConfig("text",n?n.innerText:""),o.setKookitConfig("count",e+""),ti=!0,setTimeout(()=>{ti=!1},100)}},oi=(t,e,i,r)=>{var n=o.getKookitConfig("chapterTitle"),n=Ze.findIndex(e,{label:n});n!==e.length-1&&-1!==n&&(o.setKookitConfig("chapterTitle",e[n+1].label),o.setKookitConfig("text",""),ri(e[n+1].label,i,t,r))},ai=(t,e,i)=>{var r=!1,n=e.getBoundingClientRect();return"scroll"!==i&&(e.innerText.trim()||e.id&&"IMG"===e.tagName)?r=0<=(i=n.left)&&i<=t.offsetWidth:(e.innerText.trim()||e.id&&"IMG"===e.tagName)&&(r=(n=n.top)>=t.scrollTop&&n<=t.scrollTop+t.offsetHeight),r};class hi{constructor(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[]}getChapterDoc(){var e=-1<this.bookStr.indexOf("<mbp:pagebreak>")?this.bookStr.split("<mbp:pagebreak>"):this.bookStr.split("<address> </address>");let n=[],s=[],i="";for(let t=0;t<e.length;t++)(t=>{var e=0<t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b").length;let i=t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b"),r=t.getElementsByTagName("p"),n;for(let t=0;t<i.length;t++){var s=n&&("♦"===i[t].innerText.trim()||"●"===i[t].innerText.trim()||"◾"===i[t].innerText.trim()||"◀"===i[t].innerText.trim()||"◼"===i[t].innerText.trim()||"■"===i[t].innerText.trim());if(i[t].innerText.trim()&&!s){n=i[t];break}}for(let t=0;t<r.length&&(!r[t].innerText.trim()||-1!==r[t].innerHTML.indexOf("<"));t++);var o=n&&30<n.innerText.trim().length,t=50<t.body.innerText.length;return e&&(!o||a(n.innerText.trim()))&&t})((new DOMParser).parseFromString(e[t],"text/html"))?(n.push(i+e[t]),i=""):i+=e[t];0===n.length&&n.push(i);for(let r=0;r<n.length;r++){let t=(new DOMParser).parseFromString(n[r],"text/html"),e=t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b"),i;for(let t=0;t<e.length;t++){var o="♦"===e[t].innerText.trim()||"●"===e[t].innerText.trim()||"◾"===e[t].innerText.trim()||"◀"===e[t].innerText.trim()||"◼"===e[t].innerText.trim()||"■"===e[t].innerText.trim();if(e[t].innerText.trim()&&!o){i=e[t];break}}this.chapterDocList.push({title:i?-1===s.indexOf(i.innerText)?i.innerText:i.innerText+"#"+r:"Forword",text:n[r]}),i&&s.push(i.innerText)}return this.chapterDocList}getChapter(){for(let t=0;t<this.chapterDocList.length;t++){var e=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDocList[t].title,id:"title"+e,href:"#title"+e,subitems:[]})}return this.chapterList}}class li{constructor(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[],this.bookDoc=(new DOMParser).parseFromString(this.bookStr,"text/html"),this.chapterDomList=[]}getChapter(){if(this.chapterDomList=Array.from(this.bookDoc.querySelectorAll("h1,h2,h3,h4,font,b")),0<this.chapterDomList.length){this.insertPageBreak();let t=new hi(this.bookDoc.body.innerHTML);this.chapterDocList=t.getChapterDoc(),this.chapterList=t.getChapter()}else this.getExtraTitle(),this.generateChapterList(),this.insertPageBreak();return this.chapterList}insertPageBreak(){for(let t=0;t<this.chapterDomList.length;t++){var e=document.createElement("address"),i=document.createTextNode(" ");e.appendChild(i),this.chapterDomList[t].parentNode&&this.chapterDomList[t].parentNode.insertBefore(e,this.chapterDomList[t])}}generateChapterList(){var t;0===this.chapterDomList.length&&(t=Math.floor(9e5*Math.random())+1e5,this.chapterList.push({label:"Forword",id:"title"+t,href:"#title"+t,subitems:[]}));let e=[];for(let t=0;t<this.chapterDomList.length;t++){var i=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDomList[t]?-1===e.lastIndexOf(this.chapterDomList[t].innerText)?this.chapterDomList[t].innerText:e[e.lastIndexOf(this.chapterDomList[t].innerText)]+"#"+t:"Forword",id:"title"+i,href:"#title"+i,subitems:[]}),e.push(this.chapterList[t].label)}}getExtraTitle(){let e=!1;0===this.chapterDomList.length&&(this.chapterDomList=Array.from(this.bookDoc.getElementsByTagName("p")).filter(t=>(!e&&(t.innerText.trim().startsWith("第")&&i(t.innerText.trim())||t.innerText.trim().startsWith("Chapter")||t.innerText.trim().startsWith("CHAPTER"))&&(e=!0),a(t.innerText.trim(),e))))}getChapterDoc(){if(0<this.chapterDocList.length)return this.chapterDocList;var e,i=this.bookDoc.body.innerHTML.split("<address> </address>");for(let t=0;t<i.length;t++)i.length>this.chapterList.length&&0===t&&(e=Math.floor(9e5*Math.random())+1e5,this.chapterList.unshift({label:"Forword#"+t,id:"title"+e,href:"#title"+e,subitems:[]})),this.chapterDocList.push({title:this.chapterList[t].label,text:i[t]});return this.chapterDocList}}class ci{constructor(){this.callbacks={},this.callbacks.base={}}on(t,e){const i=this;if(void 0===t||""===t)return console.warn("wrong names"),!1;if(void 0===e)return console.warn("wrong callback"),!1;const r=this.resolveNames(t);return r.forEach(function(t){t=i.resolveName(t);i.callbacks[t.namespace]instanceof Object||(i.callbacks[t.namespace]={}),i.callbacks[t.namespace][t.value]instanceof Array||(i.callbacks[t.namespace][t.value]=[]),i.callbacks[t.namespace][t.value].push(e)}),this}off(t){const r=this;if(void 0===t||""===t)return console.warn("wrong name"),!1;const e=this.resolveNames(t);return e.forEach(function(t){var e=r.resolveName(t);if("base"!==e.namespace&&""===e.value)delete r.callbacks[e.namespace];else if("base"===e.namespace)for(const i in r.callbacks)r.callbacks[i]instanceof Object&&r.callbacks[i][e.value]instanceof Array&&(delete r.callbacks[i][e.value],0===Object.keys(r.callbacks[i]).length&&delete r.callbacks[i]);else r.callbacks[e.namespace]instanceof Object&&r.callbacks[e.namespace][e.value]instanceof Array&&(delete r.callbacks[e.namespace][e.value],0===Object.keys(r.callbacks[e.namespace]).length&&delete r.callbacks[e.namespace])}),this}trigger(t,e=[]){if(void 0===t||""===t)return console.warn("wrong name"),!1;const i=this;const r=e instanceof Array?e:[];let n=this.resolveNames(t);n=this.resolveName(n[0]),setTimeout(()=>{if("base"===n.namespace)for(const t in i.callbacks){if(i.callbacks[t]instanceof Object&&i.callbacks[t][n.value]instanceof Array)i.callbacks[t][n.value].forEach(function(t){t.apply(i,r)});else if(this.callbacks[n.namespace]instanceof Object){if(""===n.value)return console.warn("wrong name"),this;i.callbacks[n.namespace][n.value].forEach(function(t){t.apply(i,r)})}return null}},100)}resolveNames(t){let e=t;return e=e.replace(/[^a-zA-Z0-9 ,/.]/g,""),e=e.replace(/[,/]+/g," "),e=e.split(" "),e}resolveName(t){const e={};var i=t.split(".");return e.original=t,e.value=i[0],e.namespace="base",1<i.length&&""!==i[1]&&(e.namespace=i[1]),e}}function ui(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),new TextDecoder("utf-8").decode(t)}var fi=new DOMParser;class di{constructor(t){this.capacity=t,this.fragment_list=[],this.imageArray=[],this.cur_fragment=new mi(t),this.fragment_list.push(this.cur_fragment)}write(t){this.cur_fragment.write(t)||(this.cur_fragment=new mi(this.capacity),this.fragment_list.push(this.cur_fragment),this.cur_fragment.write(t))}get(t){for(var e=0;e<this.fragment_list.length;){var i=this.fragment_list[e];if(t<i.size)return i.get(t);t-=i.size,e+=1}return null}size(){for(var t=0,e=0;e<this.fragment_list.length;e++)t+=this.fragment_list[e].size;return t}shrink(){for(var t=new Uint8Array(this.size()),e=0,i=0;i<this.fragment_list.length;i++){var r=this.fragment_list[i];r.full()?t.set(r.buffer,e):t.set(r.buffer.slice(0,r.size),e),e+=r.size}return t}}class mi{constructor(t){this.buffer=new Uint8Array(t),this.capacity=t,this.size=0}write(t){return!(this.size>=this.capacity)&&(this.buffer[this.size]=t,this.size+=1,!0)}full(){return this.size===this.capacity}get(t){return this.buffer[t]}}class gi{constructor(t){this.render_image=(s,o)=>new Promise((i,e)=>{var r=s[o],t=+r.getAttribute("recindex"),n=this.read_image(t-1),t=new FileReader;t.onload=t=>{var e;r.src=null===(e=t.target)||void 0===e?void 0:e.result,i(null===(t=t.target)||void 0===t?void 0:t.result)},t.onerror=function(t){e(t)},t.readAsDataURL(n)}),this.view=new DataView(t),this.buffer=this.view.buffer,this.offset=0,this.header=null}parse(){}getUint8(){var t=this.view.getUint8(this.offset);return this.offset+=1,t}getUint16(){var t=this.view.getUint16(this.offset);return this.offset+=2,t}getUint32(){var t=this.view.getUint32(this.offset);return this.offset+=4,t}getStr(t){var e=ui(this.buffer.slice(this.offset,this.offset+t));return this.offset+=t,e}skip(t){this.offset+=t}setoffset(t){this.offset=t}get_record_extrasize(t,e){for(var i,r,n,s=t.length-1,o=0,a=15;0<a;a--)e&1<<a&&(r=(i=this.buffer_get_varlen(t,s))[0],n=i[1],s=i[2],s-=r-n,o+=r);return 1&e&&(o+=1+(3&t[s])),o}buffer_get_varlen(t,e){for(var i=0,r=0,n=0,s=0;;0){var o=t[e];if(r|=(127&o)<<s,s+=7,i+=1,--e,4<=(n+=1)||0<(128&o))break}return[r,i,e]}read_text(){for(var t=this.palm_header.record_count,e=[],i=1;i<=t;i++)e.push(this.read_text_record(i));return ui(function(e){var i=0;for(let t=0;t<e.length;t++){var r=e[t];i+=r.length}var n=new Uint8Array(i),s=0;for(let t=0;t<e.length;t++)r=e[t],n.set(r,s),s+=r.length;return n}(e))}read_text_record(t){var e=this.mobi_header.extra_flags,i=this.reclist[t].offset,r=this.reclist[t+1].offset,t=new Uint8Array(this.buffer.slice(i,r)),e=this.get_record_extrasize(t,e),t=new Uint8Array(this.buffer.slice(i,r-e));return 2!==this.palm_header.compression?t:function(t){for(var e=t.length,i=0,r=new di(t.length);i<e;){var n=t[i];if(i+=1,0===n)r.write(n);else if(n<=8){for(var s=i;s<i+n;s++)r.write(t[s]);i+=n}else if(n<=127)r.write(n);else if(n<=191){var o=t[i];i+=1;var a=(n<<8|o)>>3&2047,h=3+(7&o),l=r.size();for(let t=0;t<h;t++)r.write(r.get(l-a)),l+=1}else r.write(32),r.write(128^n)}return r}(t).shrink()}read_image(t){var e=this.mobi_header.first_image_idx,i=this.reclist[e+t].offset,t=this.reclist[e+t+1].offset,t=new Uint8Array(this.buffer.slice(i,t));return new Blob([t.buffer])}load(){this.header=this.load_pdbheader(),this.reclist=this.load_reclist(),this.load_record0()}load_pdbheader(){var t={};return t.name=this.getStr(32),t.attr=this.getUint16(),t.version=this.getUint16(),t.ctime=this.getUint32(),t.mtime=this.getUint32(),t.btime=this.getUint32(),t.mod_num=this.getUint32(),t.appinfo_offset=this.getUint32(),t.sortinfo_offset=this.getUint32(),t.type=this.getStr(4),t.creator=this.getStr(4),t.uid=this.getUint32(),t.next_rec=this.getUint32(),t.record_num=this.getUint16(),t}load_reclist(){for(var t=[],e=0;e<this.header.record_num;e++){var i={};i.offset=this.getUint32(),i.attr=this.getUint32(),t.push(i)}return t}load_record0(){this.palm_header=this.load_record0_header(),this.mobi_header=this.load_mobi_header()}load_record0_header(){var t={},e=this.reclist[0];return this.setoffset(e.offset),t.compression=this.getUint16(),this.skip(2),t.text_length=this.getUint32(),t.record_count=this.getUint16(),t.record_size=this.getUint16(),t.encryption_type=this.getUint16(),this.skip(2),t}load_mobi_header(){var t={},e=this.offset;return t.identifier=this.getUint32(),t.header_length=this.getUint32(),t.mobi_type=this.getUint32(),t.text_encoding=this.getUint32(),t.uid=this.getUint32(),t.generator_version=this.getUint32(),this.skip(40),t.first_nonbook_index=this.getUint32(),t.full_name_offset=this.getUint32(),t.full_name_length=this.getUint32(),t.language=this.getUint32(),t.input_language=this.getUint32(),t.output_language=this.getUint32(),t.min_version=this.getUint32(),t.first_image_idx=this.getUint32(),t.huff_rec_index=this.getUint32(),t.huff_rec_count=this.getUint32(),t.datp_rec_index=this.getUint32(),t.datp_rec_count=this.getUint32(),t.exth_flags=this.getUint32(),this.skip(36),t.drm_offset=this.getUint32(),t.drm_count=this.getUint32(),t.drm_size=this.getUint32(),t.drm_flags=this.getUint32(),this.skip(8),this.skip(4),this.skip(46),t.extra_flags=this.getUint16(),this.setoffset(e+t.header_length),t}load_exth_header(){return{}}extractContent(t){var e=document.createElement("span");return e.innerHTML=t,e.textContent||e.innerText}render(){return new Promise((i,t)=>n(this,void 0,void 0,function*(){this.load();var t=this.read_text(),t=fi.parseFromString(t,"text/html").documentElement,e=t.getElementsByTagName("img");for(let t=0;t<e.length;t++)yield this.render_image(e,t);i(t)}))}}class pi{constructor(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[],this.bookDoc=(new DOMParser).parseFromString(this.bookStr,"text/html"),this.chapterDomList=[]}getChapter(){let e=[];this.chapterDomList=Array.from(this.bookDoc.getElementsByTagName("h1"));for(let t=0;t<this.chapterDomList.length;t++){var i=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDomList[t]?-1===e.lastIndexOf(this.chapterDomList[t].innerText)?this.chapterDomList[t].innerText:e[e.lastIndexOf(this.chapterDomList[t].innerText)]+"#"+t:"Forword",id:"title"+i,href:"#title"+i,subitems:[]}),e.push(this.chapterList[t].label)}for(let t=0;t<this.chapterDomList.length;t++){this.chapterDomList[t].id=this.chapterList[t].id;var r=document.createElement("span"),n=document.createTextNode("pagebreak");r.appendChild(n),this.chapterDomList[t].parentNode.insertBefore(r,this.chapterDomList[t])}return this.chapterList}getChapterDoc(){var e,i=this.bookDoc.body.innerHTML.split("<span>pagebreak</span>").filter(t=>t.trim());for(let t=0;t<i.length;t++)i.length>this.chapterList.length&&0===t&&(e=Math.floor(9e5*Math.random())+1e5,this.chapterList.unshift({label:"Forword#"+t,id:"title"+e,href:"#title"+e,subitems:[]})),this.chapterDocList.push({title:this.chapterList[t].label,text:i[t]});return this.chapterDocList}}const bi={svg:"image/svg+xml",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",html:"text/html",htm:"text/html",xml:"text/xml",xhtml:"application/xhtml+xml"};class vi{constructor(t,e,i,r,n){this.fileNameList=t,this.zip=e,this.bookStr="",this.format=n,this.bookDoc=null,this.mode=i,this.chapterList=[],this.extension=this.fileNameList[0].split(".").reverse()[0],this.element=r,this.getBookStr()}getBookStr(){let i=document.createElement("div");var r="single"===this.mode?1:2;for(let e=0;e<this.fileNameList.length;e++){let t=document.createElement("img");t.id=e+"",t.setAttribute("style",`width: ${"scroll"===this.mode?this.element.clientWidth:(this.element.clientWidth-88)/r}px;max-height:${"scroll"===this.mode?"inherit":this.element.clientHeight}px`),i.appendChild(t)}this.bookDoc=i}getChapter(){for(let t=0;t<this.fileNameList.length;t++)this.chapterList.push({label:this.fileNameList[t],id:t+"",href:"#"+t,subitems:[]});return this.chapterList}getImgRatio(){return this.extension=this.fileNameList[0].split(".").reverse()[0],new Promise((i,t)=>n(this,void 0,void 0,function*(){var t=new Image;t.onload=function(){i(t.height/t.width)};let e;e="cbr"===this.format?this.zip.decompress(this.fileNameList[0]):"cbt"===this.format?this.zip[Ze.findLastIndex(this.zip,{name:this.fileNameList[0]})].buffer:yield this.zip.file(this.fileNameList[0]).async("arraybuffer"),t.src="data:"+bi[this.extension.toLowerCase()]+";base64,"+this.base64ArrayBuffer(e)}))}renderComic(){window.frames[0].document.body.innerHTML=this.bookDoc.outerHTML}renderImage(e){return n(this,void 0,void 0,function*(){if(this.extension=this.fileNameList[0].split(".").reverse()[0],window.frames[0].document.getElementById(e+"")&&!window.frames[0].document.getElementById(e+"").src){let t;t="cbr"===this.format?this.zip.decompress(this.fileNameList[e]):"cbt"===this.format?this.zip[Ze.findLastIndex(this.zip,{name:this.fileNameList[e]})].buffer:yield this.zip.file(this.fileNameList[e]).async("arraybuffer"),window.frames[0].document.getElementById(e+"")&&(window.frames[0].document.getElementById(e+"").src="data:"+bi[this.extension.toLowerCase()]+";base64,"+this.base64ArrayBuffer(t))}})}base64ArrayBuffer(t){for(var e,i="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(t),s=n.byteLength,t=s%3,o=s-t,a=0;a<o;a+=3)i+=r[(16515072&(e=n[a]<<16|n[a+1]<<8|n[a+2]))>>18]+r[(258048&e)>>12]+r[(4032&e)>>6]+r[63&e];return 1==t?i+=r[(252&(e=n[o]))>>2]+r[(3&e)<<4]+"==":2==t&&(i+=r[(64512&(e=n[o]<<8|n[1+o]))>>10]+r[(1008&e)>>4]+r[(15&e)<<2]+"="),i}}const yi=(t,e,i)=>{0<e&&0<window.frames[0].document.body.scrollLeft?window.frames[0].document.body.scrollBy({top:0,left:-t.offsetWidth-88,behavior:i?"smooth":"auto"}):0<e&&0===window.frames[0].document.body.scrollLeft||e<0&&window.frames[0].document.body.scrollBy({top:0,left:t.offsetWidth+88,behavior:i?"smooth":"auto"})},wi=(t,e,i="")=>{var r=i||parseInt(o.getKookitConfig("count"))||0;r?(i=Array.from(window.frames[0].document.body.querySelectorAll("img"))[r],"scroll"!==e?window.frames[0].document.body.scrollTo(r&&i?i.offsetLeft:0,0):t.scrollTo(0,r&&i?i.offsetTop:0)):("scroll"!==e?window.frames[0].document.body:t).scrollTo(0,0)};window.e=window.eval,window.a=window.atob,t.Azw3Render=class extends ci{constructor(t,e,i){super(),this.azw3Buffer=t,this.mode=e,this.isSliding=i||!1,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}renderTo(r){return n(this,void 0,void 0,function*(){return new Promise((i,t)=>n(this,void 0,void 0,function*(){if(yield f()){var e=(yield new gi(this.azw3Buffer).render()).outerHTML;this.bookStr=e,this.element=r;let t=new li(this.bookStr);this.chapterList=t.getChapter(),this.chapterDocList=t.getChapterDoc();e=o.getKookitConfig("chapterTitle")||this.chapterDocList[0].title;Xe(r),Ye(r,this.mode),ri(e,this.chapterDocList,this.element,this.mode),this.trigger("rendered"),i()}else i()}))})}getChapter(){return this.chapterList}getPageSize(){return{width:window.frames[0].document.body.scrollWidth,height:this.element.clientHeight}}goToChapter(t){ri(t,this.chapterDocList,this.element,this.mode),this.trigger("rendered")}goToPosition(t,e,i){ri(e,this.chapterDocList,this.element,this.mode),ni(this.element,this.mode,t,i),this.trigger("rendered")}prev(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?(ii(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,1,this.isSliding,this.trigger),si(this.element,this.mode)}next(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?oi(this.element,this.chapterList,this.chapterDocList,this.mode):ei(this.element,this.chapterList,this.chapterDocList,this.mode,-1,this.isSliding,this.trigger),si(this.element,this.mode)}record(){si(this.element,this.mode)}getPosition(){return{text:o.getKookitConfig("text"),chapterTitle:o.getKookitConfig("chapterTitle"),count:o.getKookitConfig("count")}}setStyle(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))}},t.ComicRender=class extends ci{constructor(t,e,i,r,n){super(),this.isSliding=n||!1,this.mode=i,this.format=r,this.zip=e,this.dataSource=t,this.element="",this.parser="",this.chapterList=[],this.largestId=parseInt(o.getKookitConfig("count"))||0}renderTo(s,o=0){return new Promise((t,e)=>n(this,void 0,void 0,function*(){if(yield f()){this.element=s,Xe(s),this.parser=new vi(this.dataSource,this.zip,this.mode,this.element,this.format),this.chapterList=this.parser.getChapter(),this.parser.renderComic(),this.renderImage(o);var i,r=yield this.parser.getImgRatio(),n=window.frames[0].document.getElementById(o+"").clientWidth*r;let e=window.frames[0].document.getElementsByTagName("img");for(let t=0;t<e.length;t++)"scroll"===this.mode?e[t].style.height=n+"px":(i="single"===this.mode?1:2,n>this.element.clientHeight?(e[t].style.height=this.element.clientHeight+"px",e[t].style.width=this.element.clientHeight/r+"px",e[t].style.paddingLeft=(this.element.clientWidth-("single"===this.mode?0:88))/2/i-this.element.clientHeight/r/2+"px"):(e[t].style.height=n+"px",e[t].style.marginTop=this.element.clientHeight/2-n/2+"px"));Ye(s,this.mode),Qe(s,this.mode),this.trigger("rendered"),t()}else t()}))}getPageSize(){return{width:window.frames[0].document.body.scrollWidth,height:this.element.clientHeight}}renderImage(t){this.parser.renderImage(t-1),this.parser.renderImage(t),this.parser.renderImage(t+1)}getChapter(){return this.chapterList}goToPosition(t,e,i){wi(this.element,this.mode,i)}goToChapter(t){wi(this.element,this.mode,this.dataSource.indexOf(t)+""),this.renderImage(this.dataSource.indexOf(t))}record(){si(this.element,this.mode);var t=parseInt(o.getKookitConfig("count"))||0;this.parser.renderImage(t-1),this.parser.renderImage(t),this.parser.renderImage(t+1)}prev(){var t=parseInt(o.getKookitConfig("count"))||0;this.parser.renderImage(t),this.parser.renderImage(t-1),this.parser.renderImage(t-2),yi(this.element,1,this.isSliding),si(this.element,this.mode)}next(){var t=parseInt(o.getKookitConfig("count"))||0;this.parser.renderImage(t),this.parser.renderImage(t+1),this.parser.renderImage(t+2),this.parser.renderImage(t+3),this.parser.renderImage(t+4),yi(this.element,-1,this.isSliding),si(this.element,this.mode)}getPosition(){return{text:o.getKookitConfig("text"),chapterTitle:o.getKookitConfig("chapterTitle"),count:o.getKookitConfig("count")}}setStyle(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))}},t.MobiRender=class extends ci{constructor(t,e,i){super(),this.mobiBuffer=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element="",this.isSliding=i||!1}renderTo(r){return new Promise((i,t)=>n(this,void 0,void 0,function*(){if(yield f()){var e=(yield new gi(this.mobiBuffer).render()).outerHTML;this.bookStr=e,this.element=r;let t=new hi(this.bookStr);this.chapterDocList=t.getChapterDoc(),this.chapterList=t.getChapter();e=o.getKookitConfig("chapterTitle")||this.chapterDocList[0].title;Xe(r),Ye(r,this.mode),ri(e,this.chapterDocList,this.element,this.mode),this.trigger("rendered"),i()}else i()}))}getPageSize(){return{width:window.frames[0].document.body.scrollWidth,height:this.element.clientHeight}}getChapter(){return this.chapterList}goToChapter(t){ri(t,this.chapterDocList,this.element,this.mode),this.trigger("rendered")}goToPosition(t,e,i){ri(e,this.chapterDocList,this.element,this.mode),ni(this.element,this.mode,t,i),this.trigger("rendered")}prev(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?(ii(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,1,this.isSliding,this.trigger),si(this.element,this.mode)}next(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?(oi(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,-1,this.isSliding,this.trigger),si(this.element,this.mode)}record(){si(this.element,this.mode)}getPosition(){return{text:o.getKookitConfig("text"),chapterTitle:o.getKookitConfig("chapterTitle"),count:o.getKookitConfig("count")}}setStyle(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))}},t.StrRender=class extends ci{constructor(t,e,i){super(),this.bookStr=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.element="",this.isSliding=i||!1}renderTo(r){return new Promise((i,t)=>n(this,void 0,void 0,function*(){if(yield f()){this.element=r;let t=new li(this.bookStr);this.chapterList=t.getChapter(),this.chapterDocList=t.getChapterDoc();var e=o.getKookitConfig("chapterTitle")||this.chapterDocList[0].title;Xe(r),ri(e,this.chapterDocList,this.element,this.mode),Ye(r,this.mode),this.trigger("rendered"),i()}else i()}))}getChapter(){return this.chapterList}getPageSize(){return{width:window.frames[0].document.body.scrollWidth,height:this.element.clientHeight}}goToChapter(t){ri(t,this.chapterDocList,this.element,this.mode),this.trigger("rendered")}goToPosition(t,e,i){ri(e,this.chapterDocList,this.element,this.mode),this.trigger("rendered"),ni(this.element,this.mode,t,i)}record(){si(this.element,this.mode)}prev(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?(ii(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,1,this.isSliding,this.trigger),si(this.element,this.mode)}next(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?(oi(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,-1,this.isSliding,this.trigger),si(this.element,this.mode)}getPosition(){return{text:o.getKookitConfig("text"),chapterTitle:o.getKookitConfig("chapterTitle"),count:o.getKookitConfig("count")}}setStyle(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))}},t.TxtRender=class extends ci{constructor(t,e,i="utf-8",r){super(),this.txtBuffer=t,this.encoding=i,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element="",this.isSliding=r||!1}renderTo(r){return new Promise((i,t)=>n(this,void 0,void 0,function*(){if(yield f()){var e=(t=>{let e="",i=!1;var r;for(r of t.split("\n"))r.trim()&&(a(r.trim(),i)?((r.trim().startsWith("第")||r.trim().startsWith("Chapter")||r.trim().startsWith("CHAPTER"))&&(i=!0),e+=`<h1>${r}</h1>`):e+=`<p>${r}</p>`);return e})(new TextDecoder(this.encoding).decode(this.txtBuffer));this.bookStr=e,this.element=r;let t=new pi(this.bookStr);this.chapterList=t.getChapter(),this.chapterDocList=t.getChapterDoc();e=o.getKookitConfig("chapterTitle")||this.chapterDocList[0].title;Xe(r),Ye(r,this.mode),ri(e,this.chapterDocList,this.element,this.mode),this.trigger("rendered"),i()}else i()}))}getChapter(){return this.chapterList}goToChapter(t){ri(t,this.chapterDocList,this.element,this.mode),this.trigger("rendered")}getPageSize(){return{width:window.frames[0].document.body.scrollWidth,height:this.element.clientHeight}}goToPosition(t,e,i){ri(e,this.chapterDocList,this.element,this.mode),this.trigger("rendered"),ni(this.element,this.mode,t,i)}record(){si(this.element,this.mode)}prev(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?(ii(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,1,this.isSliding,this.trigger),si(this.element,this.mode)}next(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?(oi(this.element,this.chapterList,this.chapterDocList,this.mode),this.trigger("rendered")):ei(this.element,this.chapterList,this.chapterDocList,this.mode,-1,this.isSliding,this.trigger),si(this.element,this.mode)}getPosition(){return{text:o.getKookitConfig("text"),chapterTitle:o.getKookitConfig("chapterTitle"),count:o.getKookitConfig("count")}}setStyle(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))}},Object.defineProperty(t,"__esModule",{value:!0})});
