!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Kookit={})}(this,function(t){"use strict";function o(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function c(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var a=(e.getKookitConfig=function(t){return(JSON.parse(localStorage.getItem("kookitConfig"))||{})[t]},e.setKookitConfig=function(t,e){var n=JSON.parse(localStorage.getItem("kookitConfig"))||{};n[t]=e,localStorage.setItem("kookitConfig",JSON.stringify(n))},e.removeKookitConfig=function(){localStorage.removeItem("kookitConfig")},e);function e(){}let r=["章","节","回","節","卷","部","輯","辑","話","集","话","篇"];String.prototype.contains=function(t){return-1<this.indexOf(t)};const h=(t,e=!1)=>t&&!t.contains("[")&&!t.contains("(")&&!t.contains("。")&&!t.contains("“")&&!t.contains("‘")&&!t.contains("；")&&!t.contains(";")&&!t.contains("…")&&(t.startsWith("CHAPTER")||t.startsWith("Chapter")||t.startsWith("序章")||t.startsWith("前言")||t.startsWith("声明")||t.startsWith("聲明")||t.startsWith("写在前面的话")||t.startsWith("后记")||t.startsWith("楔子")||t.startsWith("后序")||t.startsWith("寫在前面的話")||t.startsWith("後記")||t.startsWith("後序")||t.startsWith("第")&&n(t)||t.startsWith("卷")&&i(t)||!e&&t.contains("第")&&(" "===t[t.indexOf("第")-1]||"　"===t[t.indexOf("第")-1]||"、"===t[t.indexOf("第")-1]||"："===t[t.indexOf("第")-1]||":"===t[t.indexOf("第")-1])&&n(t.substr(t.indexOf("第")))||!e&&t.indexOf(" ")&&s(t)||!e&&t.indexOf("　")&&s(t)||!e&&t.indexOf("、")&&f(t)||!e&&t.indexOf("：")&&u(t)||!e&&t.indexOf(":")&&u(t)),n=e=>{let n=!1;for(let t=0;t<r.length&&(!(-1<e.indexOf(r[t])&&(" "===e[e.indexOf(r[t])+1]||"　"===e[e.indexOf(r[t])+1]||"、"===e[e.indexOf(r[t])+1]||"："===e[e.indexOf(r[t])+1]||-1<e.indexOf("章")||":"===e[e.indexOf(r[t])+1]))&&e[e.indexOf(r[t])+1]||((/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(e.substring(1,e.indexOf(r[t])).trim())||/^\d+$/.test(e.substring(1,e.indexOf(r[t])).trim()))&&(n=!0),!n));t++);return n},i=t=>!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf(" ")))&&!/^\d+$/.test(t.substring(1,t.indexOf(" "))))||(!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1,t.indexOf("　")))&&!/^\d+$/.test(t.substring(1,t.indexOf("　"))))||!(!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(1))&&!/^\d+$/.test(t.substring(1)))),s=t=>!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf(" ")))||(!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("　")))||(!!/^\d+$/.test(t.substring(0,t.indexOf(" ")))||!!/^\d+$/.test(t.substring(0,t.indexOf("　"))))),u=t=>!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf(":")))||(!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("：")))||(!!/^\d+$/.test(t.substring(0,t.indexOf(":")))||!!/^\d+$/.test(t.substring(0,t.indexOf("："))))),f=t=>!!/^[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343\u4e07\u842c]+$/.test(t.substring(0,t.indexOf("、")))||!!/^\d+$/.test(t.substring(0,t.indexOf("、")));var l=window,p=window.atob("ZG8gUmU=");String.prototype.contains=function(t){return-1<this.indexOf(t)};function d(){return o(void 0,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return a.removeKookitConfig(),[4,new Promise(function(t,e){t(l.e(l.a("ZG9jdW1lbnQudGl0bGU=")))})];case 1:return t.sent().contains(p)?[2,!0]:[2,!1]}})})}var m="1.13.1",g="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},y=Array.prototype,b=Object.prototype,v="undefined"!=typeof Symbol?Symbol.prototype:null,w=y.push,x=y.slice,L=b.toString,T=b.hasOwnProperty,_="undefined"!=typeof ArrayBuffer,k="undefined"!=typeof DataView,D=Array.isArray,C=Object.keys,S=Object.create,O=_&&ArrayBuffer.isView,A=isNaN,M=isFinite,U=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],W=Math.pow(2,53)-1;function B(i,o){return o=null==o?i.length-1:+o,function(){for(var t=Math.max(arguments.length-o,0),e=Array(t),n=0;n<t;n++)e[n]=arguments[n+o];switch(o){case 0:return i.call(this,e);case 1:return i.call(this,arguments[0],e);case 2:return i.call(this,arguments[0],arguments[1],e)}for(var r=Array(o+1),n=0;n<o;n++)r[n]=arguments[n];return r[o]=e,i.apply(this,r)}}function j(t){var e=typeof t;return"function"==e||"object"==e&&!!t}function N(t){return void 0===t}function I(t){return!0===t||!1===t||"[object Boolean]"===L.call(t)}function z(t){var e="[object "+t+"]";return function(t){return L.call(t)===e}}var K=z("String"),H=z("Number"),P=z("Date"),R=z("RegExp"),F=z("Error"),$=z("Symbol"),q=z("ArrayBuffer"),V=z("Function"),G=g.document&&g.document.childNodes,J=V="function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof G?function(t){return"function"==typeof t||!1}:V,Z=z("Object"),Q=k&&Z(new DataView(new ArrayBuffer(8))),X="undefined"!=typeof Map&&Z(new Map),Y=z("DataView");var tt=Q?function(t){return null!=t&&J(t.getInt8)&&q(t.buffer)}:Y,et=D||z("Array");function nt(t,e){return null!=t&&T.call(t,e)}var rt=z("Arguments");!function(){rt(arguments)||(rt=function(t){return nt(t,"callee")})}();var it=rt;function ot(t){return H(t)&&A(t)}function st(t){return function(){return t}}function at(e){return function(t){t=e(t);return"number"==typeof t&&0<=t&&t<=W}}function ut(e){return function(t){return null==t?void 0:t[e]}}var ht=ut("byteLength"),ct=at(ht),ft=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var lt=_?function(t){return O?O(t)&&!tt(t):ct(t)&&ft.test(L.call(t))}:st(!1),pt=ut("length");function dt(t,e){e=function(e){for(var n={},t=e.length,r=0;r<t;++r)n[e[r]]=!0;return{contains:function(t){return n[t]},push:function(t){return n[t]=!0,e.push(t)}}}(e);var n=E.length,r=t.constructor,i=J(r)&&r.prototype||b,o="constructor";for(nt(t,o)&&!e.contains(o)&&e.push(o);n--;)(o=E[n])in t&&t[o]!==i[o]&&!e.contains(o)&&e.push(o)}function mt(t){if(!j(t))return[];if(C)return C(t);var e,n=[];for(e in t)nt(t,e)&&n.push(e);return U&&dt(t,n),n}function gt(t,e){var n=mt(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var s=n[o];if(e[s]!==i[s]||!(s in i))return!1}return!0}function yt(t){return t instanceof yt?t:this instanceof yt?void(this._wrapped=t):new yt(t)}function bt(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,ht(t))}yt.VERSION=m,yt.prototype.valueOf=yt.prototype.toJSON=yt.prototype.value=function(){return this._wrapped},yt.prototype.toString=function(){return String(this._wrapped)};var vt="[object DataView]";function wt(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"==i||"object"==i||"object"==typeof e)&&function t(e,n,r,i){e instanceof yt&&(e=e._wrapped);n instanceof yt&&(n=n._wrapped);var o=L.call(e);if(o!==L.call(n))return!1;if(Q&&"[object Object]"==o&&tt(e)){if(!tt(n))return!1;o=vt}switch(o){case"[object RegExp]":case"[object String]":return""+e==""+n;case"[object Number]":return+e!=+e?+n!=+n:0==+e?1/+e==1/n:+e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object Symbol]":return v.valueOf.call(e)===v.valueOf.call(n);case"[object ArrayBuffer]":case vt:return t(bt(e),bt(n),r,i)}var s="[object Array]"===o;if(!s&&lt(e)){var a=ht(e);if(a!==ht(n))return!1;if(e.buffer===n.buffer&&e.byteOffset===n.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof e||"object"!=typeof n)return!1;o=e.constructor,a=n.constructor;if(o!==a&&!(J(o)&&o instanceof o&&J(a)&&a instanceof a)&&"constructor"in e&&"constructor"in n)return!1}r=r||[];i=i||[];var u=r.length;for(;u--;)if(r[u]===e)return i[u]===n;r.push(e);i.push(n);if(s){if((u=e.length)!==n.length)return!1;for(;u--;)if(!wt(e[u],n[u],r,i))return!1}else{var h,c=mt(e);if(u=c.length,mt(n).length!==u)return!1;for(;u--;)if(h=c[u],!nt(n,h)||!wt(e[h],n[h],r,i))return!1}r.pop();i.pop();return!0}(t,e,n,r)}function xt(t){if(!j(t))return[];var e,n=[];for(e in t)n.push(e);return U&&dt(t,n),n}function Lt(r){var i=pt(r);return function(t){if(null==t)return!1;var e=xt(t);if(pt(e))return!1;for(var n=0;n<i;n++)if(!J(t[r[n]]))return!1;return r!==Ct||!J(t[Tt])}}var Tt="forEach",_t=["clear","delete"],kt=["get","has","set"],Dt=_t.concat(Tt,kt),Ct=_t.concat(kt),St=["add"].concat(_t,Tt,"has"),Ot=X?Lt(Dt):z("Map"),At=X?Lt(Ct):z("WeakMap"),Mt=X?Lt(St):z("Set"),Ut=z("WeakSet");function Et(t){for(var e=mt(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function Wt(t){for(var e={},n=mt(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function Bt(t){var e,n=[];for(e in t)J(t[e])&&n.push(e);return n.sort()}function jt(u,h){return function(t){var e=arguments.length;if(h&&(t=Object(t)),e<2||null==t)return t;for(var n=1;n<e;n++)for(var r=arguments[n],i=u(r),o=i.length,s=0;s<o;s++){var a=i[s];h&&void 0!==t[a]||(t[a]=r[a])}return t}}var Nt=jt(xt),It=jt(mt),zt=jt(xt,!0);function Kt(t){if(!j(t))return{};if(S)return S(t);var e=function(){};e.prototype=t;t=new e;return e.prototype=null,t}function Ht(t){return j(t)?et(t)?t.slice():Nt({},t):t}function Pt(t){return et(t)?t:[t]}function Rt(t){return yt.toPath(t)}function Ft(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0}function $t(t,e,n){e=Ft(t,Rt(e));return N(e)?n:e}function qt(t){return t}function Vt(e){return e=It({},e),function(t){return gt(t,e)}}function Gt(e){return e=Rt(e),function(t){return Ft(t,e)}}function Jt(i,o,t){if(void 0===o)return i;switch(null==t?3:t){case 1:return function(t){return i.call(o,t)};case 3:return function(t,e,n){return i.call(o,t,e,n)};case 4:return function(t,e,n,r){return i.call(o,t,e,n,r)}}return function(){return i.apply(o,arguments)}}function Zt(t,e,n){return null==t?qt:J(t)?Jt(t,e,n):(j(t)&&!et(t)?Vt:Gt)(t)}function Qt(t,e){return Zt(t,e,1/0)}function Xt(t,e,n){return yt.iteratee!==Qt?yt.iteratee(t,e):Zt(t,e,n)}function Yt(){}function te(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}yt.toPath=Pt,yt.iteratee=Qt;var ee=Date.now||function(){return(new Date).getTime()};function ne(e){function n(t){return e[t]}var t="(?:"+mt(e).join("|")+")",r=RegExp(t),i=RegExp(t,"g");return function(t){return r.test(t=null==t?"":""+t)?t.replace(i,n):t}}var re={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ie=ne(re),oe=ne(Wt(re)),se=yt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},ae=/(.)^/,ue={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},he=/\\|'|\r|\n|\u2028|\u2029/g;function ce(t){return"\\"+ue[t]}var fe=/^\s*(\w|\$)+\s*$/;var le=0;function pe(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);n=Kt(t.prototype),i=t.apply(n,i);return j(i)?i:n}var de=B(function(i,o){function s(){for(var t=0,e=o.length,n=Array(e),r=0;r<e;r++)n[r]=o[r]===a?arguments[t++]:o[r];for(;t<arguments.length;)n.push(arguments[t++]);return pe(i,s,this,this,n)}var a=de.placeholder;return s});de.placeholder=yt;var me=B(function(e,n,r){if(!J(e))throw new TypeError("Bind must be called on a function");var i=B(function(t){return pe(e,i,n,this,r.concat(t))});return i}),ge=at(pt);function ye(t,e,n,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var i=r.length,o=0,s=pt(t);o<s;o++){var a=t[o];if(ge(a)&&(et(a)||it(a)))if(1<e)ye(a,e-1,n,r),i=r.length;else for(var u=0,h=a.length;u<h;)r[i++]=a[u++];else n||(r[i++]=a)}return r}var be=B(function(t,e){var n=(e=ye(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=me(t[r],t)}return t});var ve=B(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),we=de(ve,yt,1);function xe(t){return function(){return!t.apply(this,arguments)}}function Le(t,e){var n;return function(){return 0<--t&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}g=de(Le,2);function Te(t,e,n){e=Xt(e,n);for(var r,i=mt(t),o=0,s=i.length;o<s;o++)if(e(t[r=i[o]],r,t))return r}function _e(o){return function(t,e,n){e=Xt(e,n);for(var r=pt(t),i=0<o?0:r-1;0<=i&&i<r;i+=o)if(e(t[i],i,t))return i;return-1}}var ke=_e(1),G=_e(-1);function De(t,e,n,r){for(var i=(n=Xt(n,r,1))(e),o=0,s=pt(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<i?o=a+1:s=a}return o}function Ce(o,s,a){return function(t,e,n){var r=0,i=pt(t);if("number"==typeof n)0<o?r=0<=n?n:Math.max(n+i,r):i=0<=n?Math.min(n+1,i):n+i+1;else if(a&&n&&i)return t[n=a(t,e)]===e?n:-1;if(e!=e)return 0<=(n=s(x.call(t,r,i),ot))?n+r:-1;for(n=0<o?r:i-1;0<=n&&n<i;n+=o)if(t[n]===e)return n;return-1}}var Se=Ce(1,ke,De),V=Ce(-1,G);function Oe(t,e,n){n=(ge(t)?ke:Te)(t,e,n);if(void 0!==n&&-1!==n)return t[n]}function Ae(t,e,n){if(e=Jt(e,n),ge(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else for(var r=mt(t),i=0,o=r.length;i<o;i++)e(t[r[i]],r[i],t);return t}function Me(t,e,n){e=Xt(e,n);for(var r=!ge(t)&&mt(t),i=(r||t).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=e(t[a],a,t)}return o}function Ue(u){return function(t,e,n,r){var i=3<=arguments.length;return function(t,e,n,r){var i=!ge(t)&&mt(t),o=(i||t).length,s=0<u?0:o-1;for(r||(n=t[i?i[s]:s],s+=u);0<=s&&s<o;s+=u){var a=i?i[s]:s;n=e(n,t[a],a,t)}return n}(t,Jt(e,r,4),n,i)}}k=Ue(1),Z=Ue(-1);function Ee(t,r,e){var i=[];return r=Xt(r,e),Ae(t,function(t,e,n){r(t,e,n)&&i.push(t)}),i}function We(t,e,n){e=Xt(e,n);for(var r=!ge(t)&&mt(t),i=(r||t).length,o=0;o<i;o++){var s=r?r[o]:o;if(!e(t[s],s,t))return!1}return!0}function Be(t,e,n){e=Xt(e,n);for(var r=!ge(t)&&mt(t),i=(r||t).length,o=0;o<i;o++){var s=r?r[o]:o;if(e(t[s],s,t))return!0}return!1}function je(t,e,n,r){return ge(t)||(t=Et(t)),0<=Se(t,e,n="number"!=typeof n||r?0:n)}Y=B(function(t,n,r){var i,o;return J(n)?o=n:(n=Rt(n),i=n.slice(0,-1),n=n[n.length-1]),Me(t,function(t){var e=o;if(!e){if(null==(t=i&&i.length?Ft(t,i):t))return;e=t[n]}return null==e?e:e.apply(t,r)})});function Ne(t,e){return Me(t,Gt(e))}function Ie(t,r,e){var n,i,o=-1/0,s=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=ge(t)?t:Et(t)).length;a<u;a++)null!=(n=t[a])&&o<n&&(o=n);else r=Xt(r,e),Ae(t,function(t,e,n){i=r(t,e,n),(s<i||i===-1/0&&o===-1/0)&&(o=t,s=i)});return o}function ze(t,e,n){if(null==e||n)return(t=!ge(t)?Et(t):t)[te(t.length-1)];var r=(ge(t)?Ht:Et)(t),t=pt(r);e=Math.max(Math.min(e,t),0);for(var i=t-1,o=0;o<e;o++){var s=te(o,i),a=r[o];r[o]=r[s],r[s]=a}return r.slice(0,e)}function Ke(o,e){return function(n,r,t){var i=e?[[],[]]:{};return r=Xt(r,t),Ae(n,function(t,e){e=r(t,e,n);o(i,t,e)}),i}}var D=Ke(function(t,e,n){nt(t,n)?t[n].push(e):t[n]=[e]}),_=Ke(function(t,e,n){t[n]=e}),kt=Ke(function(t,e,n){nt(t,n)?t[n]++:t[n]=1}),_t=Ke(function(t,e,n){t[n?0:1].push(e)},!0),He=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Pe(t,e,n){return e in n}var Re=B(function(t,e){var n={},r=e[0];if(null==t)return n;J(r)?(1<e.length&&(r=Jt(r,e[1])),e=xt(t)):(r=Pe,e=ye(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var s=e[i],a=t[s];r(a,s,t)&&(n[s]=a)}return n}),Dt=B(function(t,n){var e,r=n[0];return J(r)?(r=xe(r),1<n.length&&(e=n[1])):(n=Me(ye(n,!1,!1),String),r=function(t,e){return!je(n,e)}),Re(t,r,e)});function Fe(t,e,n){return x.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function $e(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Fe(t,t.length-e)}function qe(t,e,n){return x.call(t,null==e||n?1:e)}var Ve=B(function(t,e){return e=ye(e,!0,!0),Ee(t,function(t){return!je(e,t)})}),X=B(function(t,e){return Ve(t,e)});function Ge(t,e,n,r){I(e)||(r=n,n=e,e=!1),null!=n&&(n=Xt(n,r));for(var i=[],o=[],s=0,a=pt(t);s<a;s++){var u=t[s],h=n?n(u,s,t):u;e&&!n?(s&&o===h||i.push(u),o=h):n?je(o,h)||(o.push(h),i.push(u)):je(i,u)||i.push(u)}return i}St=B(function(t){return Ge(ye(t,!0,!0))});function Je(t){for(var e=t&&Ie(t,pt).length||0,n=Array(e),r=0;r<e;r++)n[r]=Ne(t,r);return n}re=B(Je);function Ze(t,e){return t._chain?yt(e).chain():e}function Qe(n){return Ae(Bt(n),function(t){var e=yt[t]=n[t];yt.prototype[t]=function(){var t=[this._wrapped];return w.apply(t,arguments),Ze(this,e.apply(yt,t))}}),yt}Ae(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=y[e];yt.prototype[e]=function(){var t=this._wrapped;return null!=t&&(n.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0]),Ze(this,t)}}),Ae(["concat","join","slice"],function(t){var e=y[t];yt.prototype[t]=function(){var t=this._wrapped;return Ze(this,t=null!=t?e.apply(t,arguments):t)}});var Xe=Qe(Object.freeze({__proto__:null,VERSION:m,restArguments:B,isObject:j,isNull:function(t){return null===t},isUndefined:N,isBoolean:I,isElement:function(t){return!(!t||1!==t.nodeType)},isString:K,isNumber:H,isDate:P,isRegExp:R,isError:F,isSymbol:$,isArrayBuffer:q,isDataView:tt,isArray:et,isFunction:J,isArguments:it,isFinite:function(t){return!$(t)&&M(t)&&!isNaN(parseFloat(t))},isNaN:ot,isTypedArray:lt,isEmpty:function(t){if(null==t)return!0;var e=pt(t);return"number"==typeof e&&(et(t)||K(t)||it(t))?0===e:0===pt(mt(t))},isMatch:gt,isEqual:function(t,e){return wt(t,e)},isMap:Ot,isWeakMap:At,isSet:Mt,isWeakSet:Ut,keys:mt,allKeys:xt,values:Et,pairs:function(t){for(var e=mt(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},invert:Wt,functions:Bt,methods:Bt,extend:Nt,extendOwn:It,assign:It,defaults:zt,create:function(t,e){return t=Kt(t),e&&It(t,e),t},clone:Ht,tap:function(t,e){return e(t),t},get:$t,has:function(t,e){for(var n=(e=Rt(e)).length,r=0;r<n;r++){var i=e[r];if(!nt(t,i))return!1;t=t[i]}return!!n},mapObject:function(t,e,n){e=Xt(e,n);for(var r=mt(t),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=e(t[a],a,t)}return o},identity:qt,constant:st,noop:Yt,toPath:Pt,property:Gt,propertyOf:function(e){return null==e?Yt:function(t){return $t(e,t)}},matcher:Vt,matches:Vt,times:function(t,e,n){var r=Array(Math.max(0,t));e=Jt(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},random:te,now:ee,escape:ie,unescape:oe,templateSettings:se,template:function(o,t,e){t=zt({},t=!t&&e?e:t,yt.templateSettings);var n,e=RegExp([(t.escape||ae).source,(t.interpolate||ae).source,(t.evaluate||ae).source].join("|")+"|$","g"),s=0,a="__p+='";if(o.replace(e,function(t,e,n,r,i){return a+=o.slice(s,i).replace(he,ce),s=i+t.length,e?a+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),t}),a+="';\n",e=t.variable){if(!fe.test(e))throw new Error("variable is not a bare identifier: "+e)}else a="with(obj||{}){\n"+a+"}\n",e="obj";a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(e,"_",a)}catch(t){throw t.source=a,t}return(t=function(t){return n.call(this,t,yt)}).source="function("+e+"){\n"+a+"}",t},result:function(t,e,n){var r=(e=Rt(e)).length;if(!r)return J(n)?n.call(t):n;for(var i=0;i<r;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=n,i=r),t=J(o)?o.call(t):o}return t},uniqueId:function(t){var e=++le+"";return t?t+e:e},chain:function(t){return(t=yt(t))._chain=!0,t},iteratee:Qt,partial:de,bind:me,bindAll:be,memoize:function(n,r){function i(t){var e=i.cache,t=""+(r?r.apply(this,arguments):t);return nt(e,t)||(e[t]=n.apply(this,arguments)),e[t]}return i.cache={},i},delay:ve,defer:we,throttle:function(n,r,i){var o,s,a,u,h=0;function c(){h=!1===i.leading?0:ee(),o=null,u=n.apply(s,a),o||(s=a=null)}function t(){var t=ee();h||!1!==i.leading||(h=t);var e=r-(t-h);return s=this,a=arguments,e<=0||r<e?(o&&(clearTimeout(o),o=null),h=t,u=n.apply(s,a),o||(s=a=null)):o||!1===i.trailing||(o=setTimeout(c,e)),u}return i=i||{},t.cancel=function(){clearTimeout(o),h=0,o=s=a=null},t},debounce:function(e,n,r){function i(){var t=ee()-s;t<n?o=setTimeout(i,n-t):(o=null,r||(u=e.apply(h,a)),o||(a=h=null))}var o,s,a,u,h,t=B(function(t){return h=this,a=t,s=ee(),o||(o=setTimeout(i,n),r&&(u=e.apply(h,a))),u});return t.cancel=function(){clearTimeout(o),o=a=h=null},t},wrap:function(t,e){return de(e,t)},negate:xe,compose:function(){var n=arguments,r=n.length-1;return function(){for(var t=r,e=n[r].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:Le,once:g,findKey:Te,findIndex:ke,findLastIndex:G,sortedIndex:De,indexOf:Se,lastIndexOf:V,find:Oe,detect:Oe,findWhere:function(t,e){return Oe(t,Vt(e))},each:Ae,forEach:Ae,map:Me,collect:Me,reduce:k,foldl:k,inject:k,reduceRight:Z,foldr:Z,filter:Ee,select:Ee,reject:function(t,e,n){return Ee(t,xe(Xt(e)),n)},every:We,all:We,some:Be,any:Be,contains:je,includes:je,include:je,invoke:Y,pluck:Ne,where:function(t,e){return Ee(t,Vt(e))},max:Ie,min:function(t,r,e){var n,i,o=1/0,s=1/0;if(null==r||"number"==typeof r&&"object"!=typeof t[0]&&null!=t)for(var a=0,u=(t=ge(t)?t:Et(t)).length;a<u;a++)null!=(n=t[a])&&n<o&&(o=n);else r=Xt(r,e),Ae(t,function(t,e,n){((i=r(t,e,n))<s||i===1/0&&o===1/0)&&(o=t,s=i)});return o},shuffle:function(t){return ze(t,1/0)},sample:ze,sortBy:function(t,r,e){var i=0;return r=Xt(r,e),Ne(Me(t,function(t,e,n){return{value:t,index:i++,criteria:r(t,e,n)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index}),"value")},groupBy:D,indexBy:_,countBy:kt,partition:_t,toArray:function(t){return t?et(t)?x.call(t):K(t)?t.match(He):ge(t)?Me(t,qt):Et(t):[]},size:function(t){return null==t?0:(ge(t)?t:mt(t)).length},pick:Re,omit:Dt,first:$e,head:$e,take:$e,initial:Fe,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:qe(t,Math.max(0,t.length-e))},rest:qe,tail:qe,drop:qe,compact:function(t){return Ee(t,Boolean)},flatten:function(t,e){return ye(t,e,!1)},without:X,uniq:Ge,unique:Ge,union:St,intersection:function(t){for(var e=[],n=arguments.length,r=0,i=pt(t);r<i;r++){var o=t[r];if(!je(e,o)){for(var s=1;s<n&&je(arguments[s],o);s++);s===n&&e.push(o)}}return e},difference:Ve,unzip:Je,transpose:Je,zip:re,object:function(t,e){for(var n={},r=0,i=pt(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n=n||(e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(x.call(t,r,r+=e));return n},mixin:Qe,default:yt}));Xe._=Xe;function Ye(t,e){var n,r=document.getElementsByTagName("iframe")[0];"scroll"===e?(n=r.contentWindow.document.body,e=r.contentWindow.document.documentElement,r.height=2*Math.max(n.scrollHeight,n.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),setTimeout(function(){var t=document.getElementsByTagName("iframe")[0],e=t.contentWindow.document.body,n=e.lastElementChild,r=e.lastChild,i=e.getElementsByTagName("a"),o=e.getElementsByTagName("p"),s=e.getElementsByTagName("img"),e=i[i.length-1],i=o[o.length-1],o=o[s.length-1],s=i||e||o;Xe.isElement(e)&&Xe.isElement(i)&&(s=e.clientHeight+e.offsetTop>i.clientHeight+i.offsetTop?e:i),Xe.isElement(o)&&o.clientHeight+o.offsetTop>s.clientHeight+s.offsetTop&&(s=o);i=0;(n||s||r)&&(3!==r.nodeType||n||s)&&(3===r.nodeType&&document.createRange&&((o=document.createRange()).selectNodeContents(r),!o.getBoundingClientRect||(o=o.getBoundingClientRect())&&(i=o.bottom-o.top)),t.height=Math.max(Xe.isElement(n)?n.clientHeight+n.offsetTop:0,Xe.isElement(r)?r.clientHeight+r.offsetTop:0,Xe.isElement(s)?s.clientHeight+s.offsetTop:0)+400+(3===r.nodeType?i:0))},500)):r.height=t.offsetHeight}function tn(t){var e=document.createElement("iframe");e.style.width="100%",e.style.border="0",e.style.margin="0",e.style.padding="0",e.style.fontSize="100%",e.style.font="inherit",e.style.verticalAlign="baseline",t.innerHTML="",t.appendChild(e)}function en(t,e){"scroll"!==e&&window.frames[0].document.body.setAttribute("style","width: auto;\n    height: 100%;\n    overflow-y: hidden;\n    overflow-X: hidden;\n    padding-left: 0px;\n    padding-right: 0px;\n    margin: 0px !important;\n    box-sizing: border-box;\n    max-width: inherit;\n    column-fill: auto;\n    column-gap: 88px;\n    column-count: 12;\n    column-width: "+(t.offsetWidth-88)/("double"===e?2:1)+"px;")}function nn(t,e,n,r,i){0<i&&0<window.frames[0].document.body.scrollLeft?window.frames[0].document.body.scrollLeft-=t.offsetWidth+88:0<i&&0===window.frames[0].document.body.scrollLeft?rn(t,e,n,r):i<0&&(function(t,e,n,r){if(Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<10&&Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10)cn(t,e,n,r)}(t,e,n,r),window.frames[0].document.body.scrollLeft+=t.offsetWidth+88)}function rn(t,e,n,r){var i=a.getKookitConfig("chapterTitle"),o=Xe.findIndex(e,{label:i});0!==o&&-1!==o&&i&&(a.setKookitConfig("chapterTitle",e[o-1].label),a.setKookitConfig("text","prevChapter"),on(e[o-1].label,n,t,r))}function on(t,e,n,r){void 0===t&&(t=""),window.frames[0].document.body.innerHTML="",t=-1===(t=Xe.findIndex(e,{title:t}))?0:t,window.frames[0].document.body.innerHTML=e[t].text,a.setKookitConfig("chapterTitle",e[t].title),Ye(n,r),function(){var t=document.getElementsByTagName("iframe")[0];if(t){t=t.contentDocument;if(t)for(var e,n,r=0,i=t.getElementsByTagName("img");r<i.length;r++){var o=i[r],s=o.parentElement;o.width&&o.height?o.height/o.width>s.clientHeight/s.clientWidth?n=(e=s.clientHeight)*o.width/o.height:e=(n=s.clientWidth)*o.height/o.width:n=s.clientWidth,o.setAttribute("style","max-width: "+n+"px;max-height:"+e+"px")}}}(),sn(n,r)}function sn(t,e,n,r){void 0===r&&(r="0");var i=(n=void 0===n?"":n)||a.getKookitConfig("text")||"";i?(n=Array.from(window.frames[0].document.body.querySelectorAll("h1,h2,h3,h4,p")).filter(function(t,e){return t.innerText===i&&e===parseInt(a.getKookitConfig("count")||r)})[0],"scroll"!==e?window.frames[0].document.body.scrollTo(i&&n?n.offsetLeft:"prevChapter"===i?window.frames[0].document.body.scrollWidth:0,0):t.scrollTo(0,i&&n?n.offsetTop:0)):("scroll"!==e?window.frames[0].document.body:t).scrollTo(0,0)}function an(e,n){if(!hn){for(var t=Array.from(window.frames[0].document.body.querySelectorAll("h1,h2,h3,h4,p,img")).filter(function(t){return un(e,t,n)&&t.innerText.trim()}),r=t["scroll"===n?Math.floor(t.length/2):0],i=0,o=Array.from(window.frames[0].document.body.querySelectorAll("h1,h2,h3,h4,p,img")),s=0;s<o.length;s++){if(un(e,o[s],n)){i=s;break}if(un(e,o[s],n)&&r&&o[s].innerHTML===r.innerHTML&&"IMG"!==o[s].tagName){i=s;break}}a.setKookitConfig("text",r?r.innerText:""),a.setKookitConfig("count",i+""),hn=!0,setTimeout(function(){hn=!1},100)}}function un(t,e,n){var r=!1,i=e.getBoundingClientRect();return"scroll"!==n&&(e.innerText.trim()||e.id&&"IMG"===e.tagName)?r=0<=(n=i.left)&&n<=t.offsetWidth:(e.innerText.trim()||e.id&&"IMG"===e.tagName)&&(r=(i=i.top)>=t.scrollTop&&i<=t.scrollTop+t.offsetHeight),r}var hn=!1,cn=function(t,e,n,r){var i=a.getKookitConfig("chapterTitle"),i=Xe.findIndex(e,{label:i});i!==e.length-1&&-1!==i&&(a.setKookitConfig("chapterTitle",e[i+1].label),a.setKookitConfig("text",""),on(e[i+1].label,n,t,r))},fn=(ln.prototype.getChapterDoc=function(){for(var t=-1<this.bookStr.indexOf("<mbp:pagebreak>")?this.bookStr.split("<mbp:pagebreak>"):this.bookStr.split("<address> </address>"),e=[],n=[],r="",i=0;i<t.length;i++)(t=>{var e=0<t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b").length;let n=t.querySelectorAll("h1,h2,h3,h4,blockquote,font,b"),r=t.getElementsByTagName("p"),i;for(let t=0;t<n.length;t++){var o=i&&("♦"===n[t].innerText.trim()||"●"===n[t].innerText.trim()||"◾"===n[t].innerText.trim()||"◀"===n[t].innerText.trim()||"◼"===n[t].innerText.trim()||"■"===n[t].innerText.trim());if(n[t].innerText.trim()&&!o){i=n[t];break}}for(let t=0;t<r.length&&(!r[t].innerText.trim()||-1!==r[t].innerHTML.indexOf("<"));t++);var s=i&&30<i.innerText.trim().length,t=50<t.body.innerText.length;return e&&(!s||h(i.innerText.trim()))&&t})((new DOMParser).parseFromString(t[i],"text/html"))?(e.push(r+t[i]),r=""):r+=t[i];0===e.length&&e.push(r);for(i=0;i<e.length;i++){for(var o=(new DOMParser).parseFromString(e[i],"text/html").querySelectorAll("h1,h2,h3,h4,blockquote,font,b"),s=void 0,a=0;a<o.length;a++){var u="♦"===o[a].innerText.trim()||"●"===o[a].innerText.trim()||"◾"===o[a].innerText.trim()||"◀"===o[a].innerText.trim()||"◼"===o[a].innerText.trim()||"■"===o[a].innerText.trim();if(o[a].innerText.trim()&&!u){s=o[a];break}}this.chapterDocList.push({title:s?-1===n.indexOf(s.innerText)?s.innerText:s.innerText+"#"+i:"Forword",text:e[i]}),s&&n.push(s.innerText)}return this.chapterDocList},ln.prototype.getChapter=function(){for(var t=0;t<this.chapterDocList.length;t++){var e=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDocList[t].title,id:"title"+e,href:"#title"+e,subitems:[]})}return this.chapterList},ln);function ln(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[]}var pn=(dn.prototype.getChapter=function(){var t;return this.chapterDomList=Array.from(this.bookDoc.querySelectorAll("h1,h2,h3,h4,font,b")),0<this.chapterDomList.length?(this.insertPageBreak(),t=new fn(this.bookDoc.body.innerHTML),this.chapterDocList=t.getChapterDoc(),this.chapterList=t.getChapter()):(this.getExtraTitle(),this.generateChapterList(),this.insertPageBreak()),this.chapterList},dn.prototype.insertPageBreak=function(){for(var t=0;t<this.chapterDomList.length;t++){var e=document.createElement("address"),n=document.createTextNode(" ");e.appendChild(n),this.chapterDomList[t].parentNode&&this.chapterDomList[t].parentNode.insertBefore(e,this.chapterDomList[t])}},dn.prototype.generateChapterList=function(){0===this.chapterDomList.length&&(n=Math.floor(9e5*Math.random())+1e5,this.chapterList.push({label:"Forword",id:"title"+n,href:"#title"+n,subitems:[]}));for(var t=[],e=0;e<this.chapterDomList.length;e++){var n=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDomList[e]?-1===t.lastIndexOf(this.chapterDomList[e].innerText)?this.chapterDomList[e].innerText:t[t.lastIndexOf(this.chapterDomList[e].innerText)]+"#"+e:"Forword",id:"title"+n,href:"#title"+n,subitems:[]}),t.push(this.chapterList[e].label)}},dn.prototype.getExtraTitle=function(){var e=!1;0===this.chapterDomList.length&&(this.chapterDomList=Array.from(this.bookDoc.getElementsByTagName("p")).filter(function(t){return!e&&(t.innerText.trim().startsWith("第")&&n(t.innerText.trim())||t.innerText.trim().startsWith("Chapter")||t.innerText.trim().startsWith("CHAPTER"))&&(e=!0),h(t.innerText.trim(),e)}))},dn.prototype.getChapterDoc=function(){if(0<this.chapterDocList.length)return this.chapterDocList;for(var t,e=this.bookDoc.body.innerHTML.split("<address> </address>"),n=0;n<e.length;n++)e.length>this.chapterList.length&&0===n&&(t=Math.floor(9e5*Math.random())+1e5,this.chapterList.unshift({label:"Forword#"+n,id:"title"+t,href:"#title"+t,subitems:[]})),this.chapterDocList.push({title:this.chapterList[n].label,text:e[n]});return this.chapterDocList},dn);function dn(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[],this.bookDoc=(new DOMParser).parseFromString(this.bookStr,"text/html"),this.chapterDomList=[]}mn.prototype.renderTo=function(r){var e=this;return new Promise(function(n,t){return o(e,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return[4,d()];case 1:return t.sent()?(this.element=r,e=new pn(this.bookStr),this.chapterList=e.getChapter(),this.chapterDocList=e.getChapterDoc(),e=a.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,tn(r),on(e,this.chapterDocList,this.element,this.mode),en(r,this.mode),n(),[2]):(n(),[2])}})})})},mn.prototype.getChapter=function(){return this.chapterList},mn.prototype.goToChapter=function(t){on(t,this.chapterDocList,this.element,this.mode)},mn.prototype.goToPosition=function(t,e,n){on(e,this.chapterDocList,this.element,this.mode),sn(this.element,this.mode,t,n)},mn.prototype.record=function(){an(this.element,this.mode)},mn.prototype.prev=function(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?rn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,1),an(this.element,this.mode)},mn.prototype.next=function(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?cn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,-1),an(this.element,this.mode)},mn.prototype.getPosition=function(){return{text:a.getKookitConfig("text"),chapterTitle:a.getKookitConfig("chapterTitle"),count:a.getKookitConfig("count")}},mn.prototype.setStyle=function(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))},_t=mn;function mn(t,e){this.bookStr=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.element=""}function gn(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),new TextDecoder("utf-8").decode(t)}var yn=new DOMParser,bn=(vn.prototype.write=function(t){this.cur_fragment.write(t)||(this.cur_fragment=new wn(this.capacity),this.fragment_list.push(this.cur_fragment),this.cur_fragment.write(t))},vn.prototype.get=function(t){for(var e=0;e<this.fragment_list.length;){var n=this.fragment_list[e];if(t<n.size)return n.get(t);t-=n.size,e+=1}return null},vn.prototype.size=function(){for(var t=0,e=0;e<this.fragment_list.length;e++)t+=this.fragment_list[e].size;return t},vn.prototype.shrink=function(){for(var t=new Uint8Array(this.size()),e=0,n=0;n<this.fragment_list.length;n++){var r=this.fragment_list[n];r.full()?t.set(r.buffer,e):t.set(r.buffer.slice(0,r.size),e),e+=r.size}return t},vn);function vn(t){this.capacity=t,this.fragment_list=[],this.imageArray=[],this.cur_fragment=new wn(t),this.fragment_list.push(this.cur_fragment)}var wn=(xn.prototype.write=function(t){return!(this.size>=this.capacity)&&(this.buffer[this.size]=t,this.size+=1,!0)},xn.prototype.full=function(){return this.size===this.capacity},xn.prototype.get=function(t){return this.buffer[t]},xn);function xn(t){this.buffer=new Uint8Array(t),this.capacity=t,this.size=0}var Ln=(Tn.prototype.parse=function(){},Tn.prototype.getUint8=function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},Tn.prototype.getUint16=function(){var t=this.view.getUint16(this.offset);return this.offset+=2,t},Tn.prototype.getUint32=function(){var t=this.view.getUint32(this.offset);return this.offset+=4,t},Tn.prototype.getStr=function(t){var e=gn(this.buffer.slice(this.offset,this.offset+t));return this.offset+=t,e},Tn.prototype.skip=function(t){this.offset+=t},Tn.prototype.setoffset=function(t){this.offset=t},Tn.prototype.get_record_extrasize=function(t,e){for(var n,r,i,o=t.length-1,s=0,a=15;0<a;a--)e&1<<a&&(r=(n=this.buffer_get_varlen(t,o))[0],i=n[1],o=n[2],o-=r-i,s+=r);return 1&e&&(s+=1+(3&t[o])),s},Tn.prototype.buffer_get_varlen=function(t,e){for(var n=0,r=0,i=0,o=0;;0){var s=t[e];if(r|=(127&s)<<o,o+=7,n+=1,--e,4<=(i+=1)||0<(128&s))break}return[r,n,e]},Tn.prototype.read_text=function(){for(var t=this.palm_header.record_count,e=[],n=1;n<=t;n++)e.push(this.read_text_record(n));return gn(function(t){for(var e=0,n=0;n<t.length;n++){var r=t[n];e+=r.length}for(var i=new Uint8Array(e),o=0,n=0;n<t.length;n++)r=t[n],i.set(r,o),o+=r.length;return i}(e))},Tn.prototype.read_text_record=function(t){var e=this.mobi_header.extra_flags,n=this.reclist[t].offset,r=this.reclist[t+1].offset,t=new Uint8Array(this.buffer.slice(n,r)),e=this.get_record_extrasize(t,e),t=new Uint8Array(this.buffer.slice(n,r-e));return 2!==this.palm_header.compression?t:function(t){for(var e=t.length,n=0,r=new bn(t.length);n<e;){var i=t[n];if(n+=1,0===i)r.write(i);else if(i<=8){for(var o=n;o<n+i;o++)r.write(t[o]);n+=i}else if(i<=127)r.write(i);else if(i<=191){var s=t[n];n+=1;for(var a=(i<<8|s)>>3&2047,u=3+(7&s),h=r.size(),c=0;c<u;c++)r.write(r.get(h-a)),h+=1}else r.write(32),r.write(128^i)}return r}(t).shrink()},Tn.prototype.read_image=function(t){var e=this.mobi_header.first_image_idx,n=this.reclist[e+t].offset,t=this.reclist[e+t+1].offset,t=new Uint8Array(this.buffer.slice(n,t));return new Blob([t.buffer])},Tn.prototype.load=function(){this.header=this.load_pdbheader(),this.reclist=this.load_reclist(),this.load_record0()},Tn.prototype.load_pdbheader=function(){var t={};return t.name=this.getStr(32),t.attr=this.getUint16(),t.version=this.getUint16(),t.ctime=this.getUint32(),t.mtime=this.getUint32(),t.btime=this.getUint32(),t.mod_num=this.getUint32(),t.appinfo_offset=this.getUint32(),t.sortinfo_offset=this.getUint32(),t.type=this.getStr(4),t.creator=this.getStr(4),t.uid=this.getUint32(),t.next_rec=this.getUint32(),t.record_num=this.getUint16(),t},Tn.prototype.load_reclist=function(){for(var t=[],e=0;e<this.header.record_num;e++){var n={};n.offset=this.getUint32(),n.attr=this.getUint32(),t.push(n)}return t},Tn.prototype.load_record0=function(){this.palm_header=this.load_record0_header(),this.mobi_header=this.load_mobi_header()},Tn.prototype.load_record0_header=function(){var t={},e=this.reclist[0];return this.setoffset(e.offset),t.compression=this.getUint16(),this.skip(2),t.text_length=this.getUint32(),t.record_count=this.getUint16(),t.record_size=this.getUint16(),t.encryption_type=this.getUint16(),this.skip(2),t},Tn.prototype.load_mobi_header=function(){var t={},e=this.offset;return t.identifier=this.getUint32(),t.header_length=this.getUint32(),t.mobi_type=this.getUint32(),t.text_encoding=this.getUint32(),t.uid=this.getUint32(),t.generator_version=this.getUint32(),this.skip(40),t.first_nonbook_index=this.getUint32(),t.full_name_offset=this.getUint32(),t.full_name_length=this.getUint32(),t.language=this.getUint32(),t.input_language=this.getUint32(),t.output_language=this.getUint32(),t.min_version=this.getUint32(),t.first_image_idx=this.getUint32(),t.huff_rec_index=this.getUint32(),t.huff_rec_count=this.getUint32(),t.datp_rec_index=this.getUint32(),t.datp_rec_count=this.getUint32(),t.exth_flags=this.getUint32(),this.skip(36),t.drm_offset=this.getUint32(),t.drm_count=this.getUint32(),t.drm_size=this.getUint32(),t.drm_flags=this.getUint32(),this.skip(8),this.skip(4),this.skip(46),t.extra_flags=this.getUint16(),this.setoffset(e+t.header_length),t},Tn.prototype.load_exth_header=function(){return{}},Tn.prototype.extractContent=function(t){var e=document.createElement("span");return e.innerHTML=t,e.textContent||e.innerText},Tn.prototype.render=function(){var e=this;return new Promise(function(i,t){return o(e,void 0,void 0,function(){var e,n,r;return c(this,function(t){switch(t.label){case 0:this.load(),r=this.read_text(),e=yn.parseFromString(r,"text/html").documentElement,n=e.getElementsByTagName("img"),r=0,t.label=1;case 1:return r<n.length?[4,this.render_image(n,r)]:[3,4];case 2:t.sent(),t.label=3;case 3:return r++,[3,1];case 4:return i(e),[2]}})})})},Tn);function Tn(t){var a=this;this.render_image=function(o,s){return new Promise(function(n,e){var r=o[s],t=+r.getAttribute("recindex"),i=a.read_image(t-1),t=new FileReader;t.onload=function(t){var e;r.src=null===(e=t.target)||void 0===e?void 0:e.result,n(null===(t=t.target)||void 0===t?void 0:t.result)},t.onerror=function(t){e(t)},t.readAsDataURL(i)})},this.view=new DataView(t),this.buffer=this.view.buffer,this.offset=0,this.header=null}_n.prototype.renderTo=function(r){return o(this,void 0,void 0,function(){var e=this;return c(this,function(t){return[2,new Promise(function(n,t){return o(e,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return[4,d()];case 1:return t.sent()?[4,new Ln(this.azw3Buffer).render()]:(n(),[2]);case 2:return e=t.sent(),e=e.outerHTML,this.bookStr=e,this.element=r,e=new pn(this.bookStr),this.chapterList=e.getChapter(),this.chapterDocList=e.getChapterDoc(),e=a.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,tn(r),en(r,this.mode),on(e,this.chapterDocList,this.element,this.mode),n(),[2]}})})})]})})},_n.prototype.getChapter=function(){return this.chapterList},_n.prototype.goToChapter=function(t){on(t,this.chapterDocList,this.element,this.mode)},_n.prototype.goToPosition=function(t,e,n){on(e,this.chapterDocList,this.element,this.mode),sn(this.element,this.mode,t,n)},_n.prototype.prev=function(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?rn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,1),an(this.element,this.mode)},_n.prototype.next=function(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?cn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,-1),an(this.element,this.mode)},_n.prototype.record=function(){an(this.element,this.mode)},_n.prototype.getPosition=function(){return{text:a.getKookitConfig("text"),chapterTitle:a.getKookitConfig("chapterTitle"),count:a.getKookitConfig("count")}},_n.prototype.setStyle=function(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))},Dt=_n;function _n(t,e){this.azw3Buffer=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}kn.prototype.renderTo=function(r){var e=this;return new Promise(function(n,t){return o(e,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return[4,d()];case 1:return t.sent()?[4,new Ln(this.mobiBuffer).render()]:(n(),[2]);case 2:return e=t.sent(),e=e.outerHTML,this.bookStr=e,this.element=r,e=new fn(this.bookStr),this.chapterDocList=e.getChapterDoc(),this.chapterList=e.getChapter(),e=a.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,tn(r),en(r,this.mode),on(e,this.chapterDocList,this.element,this.mode),n(),[2]}})})})},kn.prototype.getChapter=function(){return this.chapterList},kn.prototype.goToChapter=function(t){on(t,this.chapterDocList,this.element,this.mode)},kn.prototype.goToPosition=function(t,e,n){on(e,this.chapterDocList,this.element,this.mode),sn(this.element,this.mode,t,n)},kn.prototype.prev=function(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?rn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,1),an(this.element,this.mode)},kn.prototype.next=function(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?cn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,-1),an(this.element,this.mode)},kn.prototype.record=function(){an(this.element,this.mode)},kn.prototype.getPosition=function(){return{text:a.getKookitConfig("text"),chapterTitle:a.getKookitConfig("chapterTitle"),count:a.getKookitConfig("count")}},kn.prototype.setStyle=function(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))},X=kn;function kn(t,e){this.mobiBuffer=t,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}var Dn=(Cn.prototype.getChapter=function(){var t=[];this.chapterDomList=Array.from(this.bookDoc.getElementsByTagName("h1"));for(var e=0;e<this.chapterDomList.length;e++){var n=Math.floor(9e5*Math.random())+1e5;this.chapterList.push({label:this.chapterDomList[e]?-1===t.lastIndexOf(this.chapterDomList[e].innerText)?this.chapterDomList[e].innerText:t[t.lastIndexOf(this.chapterDomList[e].innerText)]+"#"+e:"Forword",id:"title"+n,href:"#title"+n,subitems:[]}),t.push(this.chapterList[e].label)}for(e=0;e<this.chapterDomList.length;e++){this.chapterDomList[e].id=this.chapterList[e].id;var r=document.createElement("span"),i=document.createTextNode("pagebreak");r.appendChild(i),this.chapterDomList[e].parentNode.insertBefore(r,this.chapterDomList[e])}return this.chapterList},Cn.prototype.getChapterDoc=function(){for(var t,e=this.bookDoc.body.innerHTML.split("<span>pagebreak</span>"),n=0;n<e.length;n++)e.length>this.chapterList.length&&0===n&&(t=Math.floor(9e5*Math.random())+1e5,this.chapterList.unshift({label:"Forword#"+n,id:"title"+t,href:"#title"+t,subitems:[]})),this.chapterDocList.push({title:this.chapterList[n].label,text:e[n]});return this.chapterDocList},Cn);function Cn(t){this.bookStr=t,this.chapterList=[],this.chapterDocList=[],this.bookDoc=(new DOMParser).parseFromString(this.bookStr,"text/html"),this.chapterDomList=[]}Sn.prototype.renderTo=function(r){var e=this;return new Promise(function(n,t){return o(e,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return[4,d()];case 1:return t.sent()?(e=new TextDecoder(this.encoding).decode(this.txtBuffer),e=function(t){for(var e="",n=!1,r=0,i=t.split("\n");r<i.length;r++){var o=i[r];o.trim()&&(h(o.trim(),n)?((o.trim().startsWith("第")||o.trim().startsWith("Chapter")||o.trim().startsWith("CHAPTER"))&&(n=!0),e+="<h1>"+o+"</h1>"):e+="<p>"+o+"</p>")}return e}(e),this.bookStr=e,this.element=r,e=new Dn(this.bookStr),this.chapterList=e.getChapter(),this.chapterDocList=e.getChapterDoc(),e=a.getKookitConfig("chapterTitle")||this.chapterDocList[0].title,tn(r),en(r,this.mode),on(e,this.chapterDocList,this.element,this.mode),n(),[2]):(n(),[2])}})})})},Sn.prototype.getChapter=function(){return this.chapterList},Sn.prototype.goToChapter=function(t){on(t,this.chapterDocList,this.element,this.mode)},Sn.prototype.goToPosition=function(t,e,n){on(e,this.chapterDocList,this.element,this.mode),sn(this.element,this.mode,t,n)},Sn.prototype.record=function(){an(this.element,this.mode)},Sn.prototype.prev=function(){"scroll"===this.mode||0===window.frames[0].document.body.scrollLeft?rn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,1),an(this.element,this.mode)},Sn.prototype.next=function(){Math.abs(window.frames[0].document.body.scrollWidth-window.frames[0].document.body.scrollLeft-window.frames[0].document.body.clientWidth)<10||"scroll"===this.mode?cn(this.element,this.chapterList,this.chapterDocList,this.mode):nn(this.element,this.chapterList,this.chapterDocList,this.mode,-1),an(this.element,this.mode)},Sn.prototype.getPosition=function(){return{text:a.getKookitConfig("text"),chapterTitle:a.getKookitConfig("chapterTitle"),count:a.getKookitConfig("count")}},Sn.prototype.setStyle=function(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))},St=Sn;function Sn(t,e,n){void 0===n&&(n="utf-8"),this.txtBuffer=t,this.encoding=n,this.mode=e,this.chapterList=[],this.chapterDocList=[],this.bookStr="",this.element=""}var On={svg:"image/svg+xml",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",html:"text/html",htm:"text/html",xml:"text/xml",xhtml:"application/xhtml+xml"},An=(Mn.prototype.getBookStr=function(){for(var t=document.createElement("div"),e="single"===this.mode?1:2,n=0;n<this.fileNameList.length;n++){var r=document.createElement("img");r.id=n+"",r.setAttribute("style","width: "+("scroll"===this.mode?this.element.clientWidth:(this.element.clientWidth-88)/e)+"px;max-height:"+("scroll"===this.mode?"inherit":this.element.clientHeight)+"px"),t.appendChild(r)}this.bookDoc=t},Mn.prototype.getChapter=function(){for(var t=0;t<this.fileNameList.length;t++)this.chapterList.push({label:this.fileNameList[t],id:t,href:"#"+t,subitems:[]});return this.chapterList},Mn.prototype.getImgRatio=function(){var e=this;return this.extension=this.fileNameList[0].split(".").reverse()[0],new Promise(function(r,t){return o(e,void 0,void 0,function(){var e,n;return c(this,function(t){switch(t.label){case 0:return((e=new Image).onload=function(){r(e.height/e.width)},"cbr"!==this.format)?[3,1]:(n=this.zip.decompress(this.fileNameList[0]),[3,4]);case 1:return"cbt"!==this.format?[3,2]:(n=this.zip[Xe.findLastIndex(this.zip,{name:this.fileNameList[0]})].buffer,[3,4]);case 2:return[4,this.zip.file(this.fileNameList[0]).async("arraybuffer")];case 3:n=t.sent(),t.label=4;case 4:return e.src="data:"+On[this.extension.toLowerCase()]+";base64,"+this.base64ArrayBuffer(n),[2]}})})})},Mn.prototype.renderComic=function(){window.frames[0].document.body.innerHTML=this.bookDoc.outerHTML},Mn.prototype.renderImage=function(n){return o(this,void 0,void 0,function(){var e;return c(this,function(t){switch(t.label){case 0:return(this.extension=this.fileNameList[0].split(".").reverse()[0],window.frames[0].document.getElementById(n+"").src)?[3,5]:(e=void 0,"cbr"!==this.format?[3,1]:(e=this.zip.decompress(this.fileNameList[n]),[3,4]));case 1:return"cbt"!==this.format?[3,2]:(e=this.zip[Xe.findLastIndex(this.zip,{name:this.fileNameList[n]})].buffer,[3,4]);case 2:return[4,this.zip.file(this.fileNameList[n]).async("arraybuffer")];case 3:e=t.sent(),t.label=4;case 4:window.frames[0].document.getElementById(n+"")&&(window.frames[0].document.getElementById(n+"").src="data:"+On[this.extension.toLowerCase()]+";base64,"+this.base64ArrayBuffer(e)),t.label=5;case 5:return[2]}})})},Mn.prototype.base64ArrayBuffer=function(t){for(var e,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(t),o=i.byteLength,t=o%3,s=o-t,a=0;a<s;a+=3)n+=r[(16515072&(e=i[a]<<16|i[a+1]<<8|i[a+2]))>>18]+r[(258048&e)>>12]+r[(4032&e)>>6]+r[63&e];return 1==t?n+=r[(252&(e=i[s]))>>2]+r[(3&e)<<4]+"==":2==t&&(n+=r[(64512&(e=i[s]<<8|i[1+s]))>>10]+r[(1008&e)>>4]+r[(15&e)<<2]+"="),n},Mn);function Mn(t,e,n,r,i){this.fileNameList=t,this.zip=e,this.bookStr="",this.format=i,this.bookDoc=null,this.mode=n,this.chapterList=[],this.extension=this.fileNameList[0].split(".").reverse()[0],this.element=r,this.getBookStr()}function Un(t,e){0<e&&0<window.frames[0].document.body.scrollLeft?window.frames[0].document.body.scrollLeft-=t.offsetWidth+88:0<e&&0===window.frames[0].document.body.scrollLeft||e<0&&(window.frames[0].document.body.scrollLeft+=t.offsetWidth+88)}En.prototype.renderTo=function(u,h){var e=this;return void 0===h&&(h=0),new Promise(function(a,t){return o(e,void 0,void 0,function(){var e,n,r,i,o,s;return c(this,function(t){switch(t.label){case 0:return[4,d()];case 1:if(!t.sent())return a(),[2];for(this.element=u,tn(u),this.parser=new An(this.dataSource,this.zip,this.mode,this.element,this.format),this.parser.renderComic(),e=h+4<this.dataSource.length?h+4:this.dataSource.length,o=0<h-4?h-4:0;o<e;o++)this.parser.renderImage(o);return[4,this.parser.getImgRatio()];case 2:for(n=t.sent(),r=window.frames[0].document.getElementById(h+"").clientWidth*n,i=window.frames[0].document.getElementsByTagName("img"),o=0;o<i.length;o++)"scroll"===this.mode?i[o].style.height=r+"px":(s="single"===this.mode?1:2,r>this.element.clientHeight?(i[o].style.height=this.element.clientHeight+"px",i[o].style.width=this.element.clientHeight/n+"px",i[o].style.paddingLeft=(this.element.clientWidth-("single"===this.mode?0:88))/2/s-this.element.clientHeight/n/2+"px"):(i[o].style.height=r+"px",i[o].style.marginTop=this.element.clientHeight/2-r/2+"px"));return en(u,this.mode),Ye(u,this.mode),a(),[2]}})})})},En.prototype.getChapter=function(){return this.chapterList},En.prototype.goToPosition=function(t,e,n){var r,i,o;r=this.element,i=this.mode,(n=(o=void 0===(o=n)?"":o)||parseInt(a.getKookitConfig("count"))||0)?(o=Array.from(window.frames[0].document.body.querySelectorAll("img"))[n],"scroll"!==i?window.frames[0].document.body.scrollTo(n&&o?o.offsetLeft:0,0):r.scrollTo(0,n&&o?o.offsetTop:0)):("scroll"!==i?window.frames[0].document.body:r).scrollTo(0,0)},En.prototype.record=function(){an(this.element,this.mode);var t=parseInt(a.getKookitConfig("count"))||0;if(!(1<this.largestId-t)){for(var e=t+10<this.dataSource.length-1?t+10:this.dataSource.length-1,n=t;n<e;n++)this.parser.renderImage(n);this.largestId=t+e-1}},En.prototype.prev=function(){var t=parseInt(a.getKookitConfig("count"))||0;if(0<t)for(var e=t+4<this.dataSource.length?t+3:this.dataSource.length,n=0<t-4?t-4:0;n<e;n++)this.parser.renderImage(n);Un(this.element,1),an(this.element,this.mode)},En.prototype.next=function(){var t=parseInt(a.getKookitConfig("count"))||0;if(t<this.dataSource.length-1)for(var e=t+4<this.dataSource.length-1?t+4:this.dataSource.length-1,n=0<t-4?t-4:0;n<e;n++)this.parser.renderImage(n);Un(this.element,-1),an(this.element,this.mode)},En.prototype.getPosition=function(){return{text:a.getKookitConfig("text"),chapterTitle:a.getKookitConfig("chapterTitle"),count:a.getKookitConfig("count")}},En.prototype.setStyle=function(t){window.frames[0].document.body.setAttribute("style",t+window.frames[0].document.body.getAttribute("style"))},re=En;function En(t,e,n,r){this.mode=n,this.format=r,this.zip=e,this.dataSource=t,this.element="",this.parser="",this.chapterList=[],this.largestId=parseInt(a.getKookitConfig("count"))||0}window.e=window.eval,window.a=window.atob,t.Azw3Render=Dt,t.ComicRender=re,t.MobiRender=X,t.StrRender=_t,t.TxtRender=St,Object.defineProperty(t,"__esModule",{value:!0})});
